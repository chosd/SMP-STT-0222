<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layouts/nolayout">
<th:block layout:fragment="html">
  <div class="contentRoot">
    <div class="content-header">
      <h2>학습요청 관리</h2>
      <div class="button-group">
        <!--등록-->
        <button id="insert-dialog-btn" class="mdc-button mdc-button--outlined mdc-ripple-upgraded">
          <span class="mdc-button__ripple"></span>
          <i class="material-icons mdc-button__icon me-1">add</i>
          <span class="mdc-button__label">등록</span>
        </button>
      </div>
    </div>

    <div class="content-body">
      <div class="card">
        <div class="card-header pb-4">
          <div class="form-row md-size multiline-align-top">
            <!-- >> 서비스 모델 검색 -->
            <div class="mdc-select mdc-select--outlined mdc-select--no-label" id="serviceModels-mdc-select">
              <div class="mdc-select__anchor">
                <div class="mdc-notched-outline">
                  <span class="mdc-notched-outline__leading"></span>
                  <div class="mdc-notched-outline__notch">
                    <label class="mdc-floating-label">서비스 모델</label>
                  </div>
                  <span class="mdc-notched-outline__trailing"></span>
                </div>
                <span class="mdc-select__selected-text-container overflow-hidden">
                                    <span class="mdc-select__selected-text"></span>
                                </span>
                <span class="mdc-select__dropdown-icon"></span>
              </div>
              <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
                <ul class="mdc-deprecated-list">
                  <li class="mdc-deprecated-list-item" data-value="''"
                      @click="searchCondition.serviceModelId=''"
                      :class="{'mdc-deprecated-list-item--selected': searchCondition.serviceModelId==''}"
                      :aria-selected="searchCondition.serviceModelId=='' ? 'true' : 'false'">
                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span class="mdc-deprecated-list-item__text">전체</span>
                  </li>
                  <li v-for="serviceModel in serviceModelList" class="mdc-deprecated-list-item"
                      :data-value="serviceModel.serviceCode"
                      @click="searchCondition.serviceModelId = serviceModel.serviceCode"
                      :class="{'mdc-deprecated-list-item--selected': searchCondition.serviceModelId == serviceModel.serviceCode} "
                      :aria-selected="searchCondition.serviceModelId == serviceModel.serviceCode ? 'true' : 'false'">

                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span
                      class="mdc-deprecated-list-item__text">{{ serviceModel.serviceModelName }}</span>
                  </li>
                </ul>
              </div>
            </div>
            <!-- << 서비스 모델 검색 -->

            <!-- << 작성자 검색 -->
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto search-bar">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text"
                     v-model="searchCondition.updatedBy"/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">작성자</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
            <!-- << 작성자 검색 -->

            <!-- >> 상태 검색 -->
            <div class="mdc-select mdc-select--outlined mdc-select--no-label"
                 id="status-mdc-select">
              <div class="mdc-select__anchor">
                <div class="mdc-notched-outline">
                  <span class="mdc-notched-outline__leading"></span>
                  <div class="mdc-notched-outline__notch">
                    <label class="mdc-floating-label">상태</label>
                  </div>
                  <span class="mdc-notched-outline__trailing"></span>
                </div>
                <span class="mdc-select__selected-text-container overflow-hidden">
                    <span class="mdc-select__selected-text"></span>
                </span>
                <span class="mdc-select__dropdown-icon"></span>
              </div>

              <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
                <ul class="mdc-deprecated-list">
                  <li class="mdc-deprecated-list-item" data-value="''"
                      @click="searchCondition.status=''"
                      :class="{'mdc-deprecated-list-item--selected': searchCondition.status==''}"
                      :aria-selected="searchCondition.status=='' ? 'true' : 'false'">
                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span class="mdc-deprecated-list-item__text">전체</span>
                  </li>
                  <li v-for="status in statuses" class="mdc-deprecated-list-item"
                      :data-value="status.key"
                      @click="searchCondition.status = status.key"
                      :class="{'mdc-deprecated-list-item--selected': searchCondition.status == status.key} "
                      :aria-selected="searchCondition.status == status.key ? 'true' : 'false'">

                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span class="mdc-deprecated-list-item__text">{{ status.value }}</span>
                  </li>
                </ul>
              </div>
            </div>
            <!-- << 상태 검색 -->

            <!-- >> 등록일 검색 -->
            <div class="flex-auto flex-ratio-two">
              <div class="form-row h-100">
                <div id="train-start-date-mdc"
                     class="mdc-text-field text-field mdc-text-field--outlined mdc-text-field--with-leading-icon w-100">
                  <i class="material-icons mdc-text-field__icon">event</i>
                  <input type="text" class="mdc-text-field__input"
                         aria-describedby="text-field-outlined-shape-one-helper-text"/>
                  <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                    <div class="mdc-notched-outline__leading"></div>
                    <div class="mdc-notched-outline__notch">
                      <label class="mdc-floating-label">등록일(from)</label>
                    </div>
                    <div class="mdc-notched-outline__trailing"></div>
                  </div>
                </div>
                <div id="train-end-date-mdc"
                     class="mdc-text-field text-field mdc-text-field--outlined mdc-text-field--with-leading-icon w-100">
                  <i class="material-icons mdc-text-field__icon">event</i>
                  <input type="text" class="mdc-text-field__input"
                         aria-describedby="text-field-outlined-shape-one-helper-text"/>
                  <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                    <div class="mdc-notched-outline__leading"></div>
                    <div class="mdc-notched-outline__notch">
                      <label class="mdc-floating-label">등록일(to)</label>
                    </div>
                    <div class="mdc-notched-outline__trailing"></div>
                  </div>
                </div>
              </div>
              <div class="mdc-text-field-helper-line">
                <p
                  class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg">
                  등록일이 없는 경우는 전체 기간을 뜻합니다.
                </p>
              </div>
            </div>
            <!-- << 등록일 검색 -->

            <!-- << 설명 검색 -->
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto search-bar">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text"
                     v-model="searchCondition.description"/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">설명</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
            <!-- << 설명 검색 -->

            <!-- << 검색 버튼 -->
            <button class="mdc-button mdc-button--unelevated mdc-ripple-upgraded"
                    @click="search(true)">
              <span class="mdc-button__ripple"></span>
              <i class="material-icons mdc-button__icon me-1">search</i>
              <span class="mdc-button__label">검색</span>
            </button>
            <!-- << 검색 버튼 -->
          </div>
        </div>

        <div class="card-body">
          <div class="table-controls form-row md-size">
            <!--검색 결과-->
            <div class="table-result-info flex-auto">
              <h4>검색결과 : <span>{{ pageInfo.total }}</span>건</h4>
            </div>

            <!-- >>> 페이지 사이즈 조절 -->
            <div class="mdc-select mdc-select--outlined mdc-select--no-label">
              <div class="mdc-select__anchor">
                <div class="mdc-notched-outline">
                  <span class="mdc-notched-outline__leading"></span>
                  <div class="mdc-notched-outline__notch">
                    <label class="mdc-floating-label">레코드 수</label>
                  </div>
                  <span class="mdc-notched-outline__trailing"></span>
                </div>
                <span class="mdc-select__selected-text-container overflow-hidden">
                                    <span class="mdc-select__selected-text"></span>
                                </span>
                <span class="mdc-select__dropdown-icon"></span>
              </div>
              <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
                <ul class="mdc-deprecated-list">
                  <li v-for="ps in pageSizes" class="mdc-deprecated-list-item"
                      :data-value="ps"
                      @click="searchCondition.pageSize = ps; currentPage = 1; search();"
                      :class="{'mdc-deprecated-list-item--selected': searchCondition.pageSize == ps} "
                      :aria-selected="searchCondition.pageSize == ps ? 'true' : 'false'">
                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span class="mdc-deprecated-list-item__text">{{ ps }}개</span>
                  </li>
                </ul>
              </div>
            </div>
            <!-- <<< 페이지 사이즈 조절 -->
          </div>

          <!-- 목록 테이블 -->
          <div class="table-container">
            <div class="mdc-data-table">
              <div class="mdc-data-table__table-container">
                <table class="mdc-data-table__table">
                  <thead>
                  <tr>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      No.
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      서비스 모델
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      모델타입
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      작성자
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      학습일시
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      상태조회
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      상태
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      재학습
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      학습데이터 양
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      모델 ID
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader"
                        scope="col">
                      모델 다운로드
                    </th>
                  </tr>
                  </thead>
                  <tbody class="mdc-data-table__content">
                  <tr v-if="searchResults.length == 0" class="mdc-data-table__row"
                      aria-selected="false"
                      style="cursor: pointer;">
                    <td class="mdc-data-table__cell text-center" colspan="11">검색된 결과가 없습니다.</td>
                  </tr>
                  <tr v-else v-for="(row, i) in searchResults"
                      :id="'row-' + row.id"
                      class="detail-service-row mdc-data-table__row"
                      aria-selected="false" style="cursor: pointer;">
                    <td class="mdc-data-table__cell text-center"
                        @click="() => openDetailDialog(row.id)">
                      {{ pageInfo.total - ( (currentPage - 1) * searchCondition.pageSize + i) }}
                    </td>
                    <td class="mdc-data-table__cell text-center"
                        @click="() => openDetailDialog(row.id)">
                      {{ convertServiceModelId2Name(row.serviceModelId) }}
                    </td>
                    <td class="mdc-data-table__cell text-center"
                        @click="() => openDetailDialog(row.id)">
                      {{ row.modelType }}
                    </td>
                    <td class="mdc-data-table__cell text-center"
                        @click="() => openDetailDialog(row.id)">
                      {{ row.updatedBy }}
                    </td>
                    <td class="mdc-data-table__cell text-center"
                        @click="() => openDetailDialog(row.id)">
                      {{ row.requestedAt }}
                    </td>
                    <td class="mdc-data-table__cell text-center">
                      <div class="sync-btn-outer">
                        <button v-if="row.status == 'TRAINING'"
                                class="up-priority-btn mdc-icon-button material-icons mdc-ripple-upgraded--unbounded mdc-ripple-upgraded  mdc-theme--primary"
                                @click="() => status(row.id)">
                          sync
                        </button>
                        <button v-else
                                class="up-priority-btn mdc-icon-button material-icons mdc-ripple-upgraded--unbounded mdc-ripple-upgraded"
                                style="color: #ccc;"
                                disabled>
                          sync
                        </button>
                      </div>
                    </td>
                    <td class="mdc-data-table__cell text-center"
                        @click="() => openDetailDialog(row.id)">
                      <span :id="'status' + row.id">{{ row.status }}</span>
                    </td>
                    <td class="mdc-data-table__cell text-center">
                      <button v-if="row.status != 'FAIL'"
                              class="mdc-button mdc-button--icon-leading mdc-theme--text-disabled-on-light"
                              disabled>
                        <span class="mdc-button__ripple"></span>
                        <span class="mdc-button__focus-ring"></span>
                        <!--                            <i class="material-icons mdc-button__icon" aria-hidden="true">backup</i>-->
                        <span class="mdc-button__label">재학습</span>
                      </button>
                      <button v-else class="mdc-button mdc-button--icon-leading"
                              @click="() => openUpdateDialog(row.id,row.serviceModelId,row.modelType)">
                        <span class="mdc-button__ripple"></span>
                        <span class="mdc-button__focus-ring"></span>
                        <!--                            <i class="material-icons mdc-button__icon" aria-hidden="true">backup</i>-->
                        <span class="mdc-button__label">재학습</span>
                      </button>
                    </td>
                    <td v-if="row.modelType == 'CLASS' || row.modelType == 'SERVICE' || row.modelType == 'E2ELM'"
                        class="mdc-data-table__cell text-center"
                        @click="() => openDetailDialog(row.id)">
                      {{ row.dataNum }}건
                    </td>
                    <td v-if="row.modelType == 'E2ESL' || row.modelType == 'E2EUSL' || row.modelType == 'E2EMSL'"
                        class="mdc-data-table__cell text-center"
                        @click="() => openDetailDialog(row.id)">
                      {{ row.dataTime }}
                    </td>

                    <td class="mdc-data-table__cell text-center"
                        @click="() => openDetailDialog(row.id)">
                      {{ row.resultModelId }}
                    </td>
                    <td class="mdc-data-table__cell text-center">
                      <button v-if="row.status == 'COMPLETE'" class="mdc-button mdc-button--icon-leading"
                              @click="() => requestResultModelDownload(row.resultModelId)">
                        <span class="mdc-button__ripple"></span>
                        <span class="mdc-button__focus-ring"></span>
                        <i class="material-icons mdc-button__icon"
                           aria-hidden="true">download</i>
                        <span class="mdc-button__label">다운로드</span>
                      </button>
                      <button v-else
                              class="mdc-button mdc-button--icon-leading mdc-theme--text-disabled-on-light"
                              disabled>
                        <span class="mdc-button__ripple"></span>
                        <span class="mdc-button__focus-ring"></span>
                        <i class="material-icons mdc-button__icon"
                           aria-hidden="true">download</i>
                        <span class="mdc-button__label">다운로드</span>
                      </button>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- pagination -->
          <div class="table-pagination mdc-data-table__pagination">
            <div class="mdc-data-table__pagination-trailing mdc-chip-set mdc-chip-set--choice">
              <div class="mdc-data-table__pagination-navigation">
                <button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
                        data-first-page="true" @click="gotoPage(1)">
                  <div class="mdc-button__icon">first_page</div>
                </button>
                <button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
                        data-prev-page="true" @click="gotoPage(currentPage - 1)">
                  <div class="mdc-button__icon">chevron_left</div>
                </button>

                <button v-for="(paging, index) in pages"
                        class="mdc-chip mdc-data-table__pagination-button fs-6 bg-transparent"
                        :class="{ 'mdc-chip--selected' : paging == currentPage }"
                        @click="gotoPage(paging)">
                  {{ paging }}
                </button>
                <button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
                        data-next-page="true" @click="gotoPage(currentPage + 1)">
                  <div class="mdc-button__icon">chevron_right</div>
                </button>
                <button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
                        data-last-page="true" @click="gotoPage(pageInfo.pages)">
                  <div class="mdc-button__icon">last_page</div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- >>> 등록 팝업 -->
  <div id="insert-dialog" class="mdc-dialog" role="alertdialog" aria-modal="true"
       aria-labelledby="simple-dialog-label" aria-describedby="simple-dialog-description" tabindex="-1">
    <div class="mdc-dialog__scrim"></div>
    <div class="mdc-dialog__container">
      <div class="mdc-dialog__surface">
        <div class="mdc-dialog__header">
          <h2 class="mdc-dialog__title">학습 등록</h2>
          <button class="mdc-icon-button material-icons close-button" tabindex="-1">
            close
          </button>
        </div>
        <!-- loading bar -->
        <div id="train-dialog-loadingbar" role="progressbar"
             class="mdc-linear-progress mdc-linear-progress--indeterminate" hidden>
          <div class="mdc-linear-progress__buffering-dots"></div>
          <div class="mdc-linear-progress__buffer"></div>
          <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
            <span class="mdc-linear-progress__bar-inner"></span>
          </div>
          <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
            <span class="mdc-linear-progress__bar-inner"></span>
          </div>
        </div>
        <section class="mdc-dialog__content form-row-stack">
          <p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-theme--error">
            * 표시 항목은 필수입력사항입니다.
          </p>

          <!-- 등록 서비스 모델 -->
          <div class="form-row">
            <div class="mdc-select mdc-select--outlined mdc-select--no-label mdc-select--required w-100"
                 id="insert-serviceModel-mdc-select">
              <div class="mdc-select__anchor" aria-required="true">
                <div class="mdc-notched-outline">
                  <span class="mdc-notched-outline__leading"></span>
                  <div class="mdc-notched-outline__notch">
                    <label class="mdc-floating-label mdc-floating-label--required">서비스 모델</label>
                  </div>
                  <span class="mdc-notched-outline__trailing"></span>
                </div>
                <span class="mdc-select__selected-text-container overflow-hidden">
                                    <span class="mdc-select__selected-text"></span>
                                </span>
                <span class="mdc-select__dropdown-icon"></span>
              </div>
              <div class="mdc-layout-grid__inner mdc-menu-surface--fixed" style="z-index: 9999;">
                <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
                  <ul class="mdc-deprecated-list">
                    <!--dynamic data-->
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!--  등록 모델타입 -->
          <div class="form-row">
            <div class="mdc-select mdc-select--outlined mdc-select--no-label mdc-select--required w-100"
                 id="insert-modelType-mdc-select">
              <div class="mdc-select__anchor" aria-required="true">
                <div class="mdc-notched-outline">
                  <span class="mdc-notched-outline__leading"></span>
                  <div class="mdc-notched-outline__notch">
                    <label class="mdc-floating-label mdc-floating-label--required">모델타입</label>
                  </div>
                  <span class="mdc-notched-outline__trailing"></span>
                </div>
                <span class="mdc-select__selected-text-container overflow-hidden">
                                    <span class="mdc-select__selected-text"></span>
                                </span>
                <span class="mdc-select__dropdown-icon"></span>
              </div>
              <div class="mdc-layout-grid__inner mdc-menu-surface--fixed" style="z-index: 9999;">
                <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
                  <ul class="mdc-deprecated-list">
                    <!--dynamic data-->
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- 등록 데이터셋 목록 -->
          <div id="amDatasetDiv" style="display: none;">
            <ul class="mdc-list" role="group" aria-label="List with checkbox items">

            </ul>
          </div>

          <!--설명-->
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text"
                     id="insert-description-input"
              />
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">설명</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
            <div class="mdc-text-field-helper-line" id="insert-description-helper-line">
            </div>
          </div>
        </section>
        <footer class="mdc-dialog__actions">
          <button id="insert-btn" class="mdc-button mdc-button--unelevated mdc-ripple-upgraded">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">학습</span>
          </button>
          <button
            class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-default mdc-theme--default-bg close-button">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">취소</span>
          </button>
        </footer>
      </div>
    </div>
  </div>
  <!-- <<< 등록 팝업 -->

  <!-- >>> 재등록 팝업 -->
  <div id="update-dialog" class="mdc-dialog" role="alertdialog" aria-modal="true"
       aria-labelledby="simple-dialog-label" aria-describedby="simple-dialog-description" tabindex="-1">
    <div class="mdc-dialog__scrim"></div>
    <div class="mdc-dialog__container">
      <div class="mdc-dialog__surface">
        <div class="mdc-dialog__header">
          <h2 class="mdc-dialog__title">재학습 등록</h2>
          <button class="mdc-icon-button material-icons close-button" tabindex="-1">
            close
          </button>
        </div>
        <!-- loading bar -->
        <div id="re-train-dialog-loadingbar" role="progressbar"
             class="mdc-linear-progress mdc-linear-progress--indeterminate"
             hidden>
          <div class="mdc-linear-progress__buffering-dots"></div>
          <div class="mdc-linear-progress__buffer"></div>
          <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
            <span class="mdc-linear-progress__bar-inner"></span>
          </div>
          <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
            <span class="mdc-linear-progress__bar-inner"></span>
          </div>
        </div>
        <section class="mdc-dialog__content form-row-stack">
          <p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-theme--error">
            * 표시 항목은 필수입력사항입니다.
          </p>

          <!-- 재학습 서비스모델-->
          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input id="update-service-model" type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">서비스 모델</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <!-- 재학습 모델타입 -->
          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input id="update-modelType" type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">모델타입</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <!-- 재학습 데이터셋 목록 -->
          <div id="amDatasetUpdateInput"
               class="mdc-text-field text-field mdc-text-field--no-label mdc-text-field--textarea form-row multiline-align-top mdc-text-field--outlined">
            <textarea class="mdc-text-field__input m-0 py-3 is-both-resize mw-100 min-w-100" readonly></textarea>
            <div class="mdc-notched-outline mdc-notched-outline--upgraded h-100">
              <div class="mdc-notched-outline__leading"></div>
              <div class="mdc-notched-outline__notch">
                <label class="mdc-floating-label">데이터셋</label>
              </div>
              <div class="mdc-notched-outline__trailing"></div>
            </div>
          </div>

          <!-- 재학습 설명-->
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
              <div class="sample mdc-layout-grid__inner ">
                  <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
                      <div class="mdc-text-field text-field mdc-text-field--outlined w-100">
                          <input type="text" class="mdc-text-field__input"
                                 aria-describedby="text-field-outlined-shape-one-helper-text"
                                 id="update-description-input"
                          />
                          <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                              <div class="mdc-notched-outline__leading"></div>
                              <div class="mdc-notched-outline__notch">
                                  <label class="mdc-floating-label">설명</label>
                              </div>
                              <div class="mdc-notched-outline__trailing"></div>
                          </div>
                      </div>
                      <div class="mdc-text-field-helper-line" id="update-description-helper-line">
                      </div>
                  </div>
              </div>
          </div>

        </section>
        <footer class="mdc-dialog__actions">
          <button id="update-detail-btn" class="mdc-button mdc-button--unelevated mdc-ripple-upgraded">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">재학습</span>
          </button>
          <button
            class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-default mdc-theme--default-bg close-button">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">취소</span>
          </button>
        </footer>
      </div>
    </div>
  </div>

  <!-- <<< 재등록 팝업 -->

  <!-- >>> 상세 팝업 -->
  <div id="detail-dialog" class="mdc-dialog mdc-dialog--scrollable" role="alertdialog" aria-modal="true"
       aria-labelledby="simple-dialog-label" aria-describedby="simple-dialog-description">
    <div class="mdc-dialog__scrim"></div>
    <div class="mdc-dialog__container">
      <div class="mdc-dialog__surface">
        <div class="mdc-dialog__header">
          <h2 class="mdc-dialog__title">학습 상세</h2>
          <button class="mdc-icon-button material-icons close-button" data-mdc-dialog-action="close" tabindex="-1">
            close
          </button>
        </div>

        <section class="mdc-dialog__content form-row-stack">
          <p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-theme--error">
            *모든 항목은 필수입력사항입니다.
          </p>

          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-service-model"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">서비스 모델</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-created-by"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">작성자</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-requested-at"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">요청 시간</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-completed-at"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">종료 시간</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <!--div class="form-row">
              <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
                  <input type="text" class="mdc-text-field__input"
                         aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                         id="detail-duration"
                         value=""/>
                  <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                      <div class="mdc-notched-outline__leading"></div>
                      <div class="mdc-notched-outline__notch">
                          <label class="mdc-floating-label">소요 시간</label>
                      </div>
                      <div class="mdc-notched-outline__trailing"></div>
                  </div>
              </div>
          </div-->

          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-status"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">상태</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-result-msg"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">실패 원인</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-data-num"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">학습데이터 양</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-result-model-id"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">모델 ID</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text"
                     id="detail-description" value=""
              />
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">설명</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
            <div class="mdc-text-field-helper-line" id="detail-description-helper-line">
            </div>
          </div>
        </section>

          <!--<div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field&#45;&#45;outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text"
                     id="detail-description"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline&#45;&#45;upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">설명</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>
          <div class="">
            <div class="mdc-text-field-helper-line" id="detail-description-helper-line">
            </div>
          </div>-->

        </section>
        <footer class="mdc-dialog__actions">
          <button
            class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-default mdc-theme--default-bg dialog-close-btn"
            data-mdc-dialog-action="close">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">닫기</span>
          </button>
          <button id="detail-update-btn" class="mdc-button mdc-button--unelevated mdc-ripple-upgraded">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">수정</span>
          </button>
        </footer>
      </div>
    </div>
  </div>
  <!-- <<< 상세 팝업 -->

  <input type="hidden" readonly id="smpServiceUriPrefix" th:value="${smpServiceUriPrefix}">
  <input type="hidden" readonly id="defaultPageSize" th:value="${defaultPageSize}">
</th:block>

<th:block layout:fragment="script">
  <script type="text/javascript">

    (function () {
      var LABEL = {
        searchCondition: {
          serviceModelId: "",
          updatedBy: "",
          status: "",
          from: "",
          to: "",
          description : "",
          pageSize: parseInt($("#defaultPageSize").val(), 10),
          modelType: ""
        },
        insertRequest: {
          serviceModelId: "",
          description: "",
          modelType: "",
          trainE2ESLDataPathList: [],
          trainE2ESLWavPathList: [],
          trainE2EUSLWavPathList: [],
          trainAmDatasetList: []
        },
        detailObj: {
          serviceModelId: "",
          description: "",
          updatedBy: "",
          requestedAt: "",
          completedAt: "",
          duration: "",
          status: "",
          resultMsg: "",
          dataNum: "",
          resultModelId: ""
        },
        trainStatuses: [
          {key: "READY", value: "미학습 상태"},
          {key: "TRAINING", value: "학습 중"},
          {key: "COMPLETE", value: "학습 완료"},
          {key: "FAIL", value: "학습 실패"}
        ]
      };
      new Vue({
        el: ".contentRoot",
        data: {
          // 팝업
          insertDialog: mdc.dialog.MDCDialog.attachTo(document.querySelector('#insert-dialog')),
          updateDialog: mdc.dialog.MDCDialog.attachTo(document.querySelector('#update-dialog')),
          detailDialog: mdc.dialog.MDCDialog.attachTo(document.querySelector('#detail-dialog')),
          trainDialogLoadingBar: $("#train-dialog-loadingbar"),
          reTrainDialogLoadingBar: $("#re-train-dialog-loadingbar"),
          // 검색
          searchCondition: {...LABEL.searchCondition},
          searching: false,
          searchResults: [],

          // pagination
          pageSizes: [10, 20, 30, 40, 50],
          currentPage: 1,
          pageInfo: {
            pages: 1,
            total: 1
          },
          pageNumLists: [1],
          /*page: {
              pageNum: 1,
              pageSize: 10,
              orderBy: 'REG_DT DESC'
          },*/

          // 검색 조건
          serviceModelList: JSON.parse("[[${serviceModelList}]]".replaceAll('&quot;', "\"")),
          SERVICE_MODEL_ID_TO_NAME: {},
          statuses: [],
          newObj: {...LABEL.insertRequest},
          detailObj: {...LABEL.detailObj},
          updateServiceModelId: "",

          // constant
          DESCRIPTION_MAX_LENGTH: 255,

          modelTypes: [
            //{key: "CLASS", value: "CLASS"}, 수협은 아래 2가지 타입만 사용
            //{key: "SERVICE", value: "SERVICE"},
            {key: "E2ELM", value: "E2ELM"},
            {key: "E2ESL", value: "E2ESL"}
            //{key: "E2EUSL", value: "E2EUSL"},
            //{key: "E2EMSL", value: "E2EMSL"}
          ],
          amDatasetList: [],
          modelTypeToName: {},
          updateModelType: "",

          // etc
          currentXhr: [],		// 모달 내 XHR 중단할 때 사용
          checkXhrAbort: false,	// 모달 내에서 등록/저장 등 업로드 시엔 컨펌 추가
          currentDialog: null     // vue data에서 정의한 모달의 key. ( :string)
        },
        computed: {
          pages: function () {
            const list = [];
            for (let index = this.startPage; index <= this.endPage; index += 1) {
              list.push(index);
            }
            return list;
          },
          startPage() {
            return parseInt((this.currentPage - 1) / 5) * 5 + 1;
          },
          endPage() {
            var lastPage = parseInt((this.currentPage - 1) / 5 + 1) * 5;
            return lastPage <= this.pageInfo.pages ? lastPage : this.pageInfo.pages;
          }
        },
        created: function () {
          // Base url 받아오기
          const baseUrl = document.querySelector('#smpServiceUriPrefix').value;
          this.baseUrl = baseUrl;

          // 데이터 구분 목록 받아오기
          var self = this;


          this.initServiceModel()

          this.initModelType()

          this.initStatus(() => {

            self.$nextTick(function () {
              const $select = $("#status-mdc-select")[0];
              $($select).data('instance').destroy();

              const newMdcSelect = new mdc.select.MDCSelect($select);
              $($select).data('instance', newMdcSelect);
            })
          })

          this.search();
        },
        mounted: function () {

          // 페이지 이동시 처리
          $('#drawer-main-content-viewer').one('page.move', function () {

            // MaterialDatepicker가 화면을 종료해도 자동으로 종료되지 않아 이벤트 unbinding 추가
            var $trainStartDateMdc = $('#train-start-date-mdc');
            var $trainEndDateMdc = $('#train-end-date-mdc');
            $trainStartDateMdc.data('datepicker').destroy();
            $trainEndDateMdc.data('datepicker').destroy();
          });

          this.initMaterialUx();
          this.initSearchBarEvents();
          var self = this;

          // >>> 등록 dialog 설정
          var insertDialog = this.insertDialog;

          /*$('#insert-dialog-btn').off('click').on('click', function () {
              insertDialog.open();
          });*/

          insertDialog.listen('MDCDialog:opening', function () {

            // 화면 및 데이터 초기화
            self.initializeInsertDialog();

            // component 이벤트 등록
            $("#insert-serviceModel-mdc-select").off('MDCSelect:change').on('MDCSelect:change', self.onChangeInsertServiceModel)
            $("#insert-modelType-mdc-select").off('MDCSelect:change').on('MDCSelect:change', self.onChangeInsertModelType)
            $("#insert-description-input").off('keyup').on('keyup', self.onChangeInsertDescription)
            $('input.chk-am-dataset').off('click').on('click', self.onClickInsertDatasetCheckbox)

            $("#insert-btn").off('click').on('click', self.insert)
          });

          $('#insert-dialog-btn').off('click').on('click', function () {
            self.insertDialog.open();
            self.currentDialog = 'insertDialog';
          });
          // <<< 등록 dialog 설정

          // >>> 재등록 dialog 설정
          var updateDialog = this.updateDialog;

          updateDialog.listen('MDCDialog:opening', function () {

            // 화면 및 데이터 초기화
            self.initializeUpdateDialog();

            // component 이벤트 등록
            $("#update-description-input").off('keyup').on('keyup', self.onChangeUpdateDialogDescription);

            $("#update-btn").off('click').on('click', self.update);
          });

          // <<< 재등록 dialog 설정

          // >>> 상세 dialog 설정
          var detailDialog = this.detailDialog;
          detailDialog.listen('MDCDialog:opening', function () {
            // 화면 및 데이터 초기화
            self.initializeDetailDialog();

            $("#detail-description").off('keyup').on('keyup', self.onChangeDetailDialogDescription);
            $("#detail-update-btn").off('click').on('click', self.detailUpdate);
          });
          // <<< 상세 dialog 설정

          // 모달 닫기 및 xhr 종료 이벤트 바인딩
          $('.close-button').off('click').on('click', function () {
            self.onCloseDialog();
          })
          $('.mdc-dialog').on('keydown', function (e) {
            if (e.key === 'Escape') self.onCloseDialog();
          })
        },
        methods: {
          initMaterialUx: function () {
            // ripple material ux 적용
            const elements = document.querySelectorAll('.mdc-ripple-upgraded');
            for (const el of elements) {
              el.class
              mdc.ripple.MDCRipple.attachTo(el, el.classList.contains('mdc-ripple-upgraded--unbounded') ? {
                isUnbounded: true
              } : void 0);
            }

            // input text material ux 적용
            const textFields = document.querySelectorAll('.mdc-text-field');
            for (const textField of textFields) {
              const mdcTextField = mdc.textField.MDCTextField.attachTo(textField);
              $(textField).data('instance', mdcTextField);
            }

            // select material ux 적용
            const selects = document.querySelectorAll('.mdc-select');
            for (const el of selects) {
              const select = mdc.select.MDCSelect.attachTo(el);
              $(el).data('instance', select); //
            }

            // linear progress material ux 적용
            const progresses = document.querySelectorAll('.mdc-linear-progress');
            for (const el of progresses) {
              const progress = mdc.linearProgress.MDCLinearProgress.attachTo(el);
              $(el).data('instance', progress); //
            }

            // dialog에 close 이벤트 주는 방법: escape key, dialog 외부 클릭 막기.
            this.insertDialog.scrimClickAction = "";
            this.detailDialog.scrimClickAction = "";

            this.initMaterialDatepickers();
          },

          initSearchBarEvents: function () {
            var self = this;
            $('.search-bar input').on("keydown", function (e) {
              if (e.keyCode == 13) {
                self.search();
              }
            });
          },

          initMaterialDatepickers: function () {

            // datepicker 적용
            var self = this;
            var $trainStartAtInput = $('#train-start-date-mdc');
            var $trainEndAtInput = $('#train-end-date-mdc');


            // https://github.com/FreddyFY/material-datepicker
            var datepickerOption = {
              lang: "en",
              orientation: "portrait",
              color: document.defaultView.getComputedStyle(document.documentElement).getPropertyValue("--mdc-theme-primary"),
              closeAfterClick: false,
              outputFormat: 'YYYY-MM-DD',
              topHeaderFormat: 'YYYY MM',
              headerFormat: 'Do' // 1st 2nd ... 30th 31st
            };

            if ($trainStartAtInput.data('datepicker') != null) {
              $trainStartAtInput.data('datepicker').destroy();
            }

            $trainStartAtInput.data('datepicker', new MaterialDatepicker($trainStartAtInput.data('instance').input, $.extend({}, datepickerOption, {
              onChange: function (date) {
                if (_.isEmpty($trainStartAtInput.data('instance').value)) {
                  self.searchCondition.from = "";
                } else {
                  self.searchCondition.from = moment(date).format("YYYY-MM-DD");
                }
              }
            })));

            if ($trainEndAtInput.data('datepicker') != null) {
              $trainEndAtInput.data('datepicker').destroy();
            }

            $trainEndAtInput.data('datepicker', new MaterialDatepicker($trainEndAtInput.data('instance').input, $.extend({}, datepickerOption, {
              onChange: function (date) {
                if (_.isEmpty($trainEndAtInput.data('instance').value)) {
                  self.searchCondition.to = "";
                } else {
                  self.searchCondition.to = moment(date).format("YYYY-MM-DD");
                }
              }
            })));

            $trainStartAtInput.data('instance').value = '';
            $trainEndAtInput.data('instance').value = '';
          },
          // AM학습데이터에서 저장된 데이터셋 목록을 등록팝업창에서 change이벤트때 불러온다.
          initAmDatasetList: function () {
            //console.log(">>>>> initAmDatasetList newObj : " , this.newObj);

            var searchConditions = {...this.newObj}
            searchConditions['pageNum'] = this.currentPage;
            commonObject.deleteNullOrDefaultFields(searchConditions);
            var queryString = Qs.stringify(searchConditions);

            $.ajax({
              url: this.baseUrl + "/train/api/datasetList?" + queryString,
              method: "get",
              contentType: 'application/json; charset=UTF-8',
              dataType: "json"

            }).done(result => {
              this.amDatasetList = result.result;

              if (this.amDatasetList.length > 0) { // AM데이터셋 결과가 있을때에만 동적처리
                var ulHtmlStr = '';
                for (var i = 0; i < this.amDatasetList.length; i++) {
                  var amDataset = this.amDatasetList[i];

                  var htmlStr = `
			                            <li class="mdc-list-item" role="checkbox" aria-checked="false">
										    <span class="mdc-list-item__ripple"></span>
										    <span class="mdc-list-item__graphic">
										      <div class="mdc-checkbox">
										        <input type="checkbox" class="mdc-checkbox__native-control chk-am-dataset" value="${amDataset.id}" id="am-dataset-${amDataset.id}"/>
										        <div class="mdc-checkbox__background">
										          <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
										            <path class="mdc-checkbox__checkmark-path" fill="none" d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
										          </svg>
										          <div class="mdc-checkbox__mixedmark"></div>
										        </div>
										      </div>
										    </span>
										    <label class="mdc-list-item__text" for="am-dataset-${amDataset.id}">${amDataset.datasetName}</label>
										</li>
										<li role="separator" class="mdc-list-divider"></li>`
                  ulHtmlStr += htmlStr
                }
                $("#amDatasetDiv ul").html(ulHtmlStr);
                $("#amDatasetDiv").show();
              } else if (this.amDatasetList.length == 0) {
                $("#amDatasetDiv").hide();
              }
            });

          },
          getPreviousDataset: function (currentId) {

            for (var i = 0; i < this.searchResults.length; i++) {
              var searchResult = this.searchResults[i];

              if (currentId == searchResult.id) { // 현재 선택한 재배포 대상
                let $amDatasetUpdateInput = $("#amDatasetUpdateInput");

                if (searchResult.trainAmDatasetList.length > 0) { // 데이터셋 목록이 있을 경우만
                  let trainAmDatasetList = ''
                  searchResult.trainAmDatasetList.map((item, index) => {
                    if (index === 0) {
                      trainAmDatasetList = item
                    } else {
                      trainAmDatasetList = trainAmDatasetList + '\n' + item
                    }
                  })
                  $amDatasetUpdateInput.data('instance').value = trainAmDatasetList;

                  // 재학습 보내기전 데이터 세팅
                  if (this.updateModelType == "E2ESL") {

                    this.newObj.trainE2ESLDataPathList.push(...searchResult.trainE2ESLDataPathList);
                    this.newObj.trainE2ESLWavPathList.push(...searchResult.trainE2ESLWavPathList);

                  } else if (this.updateModelType == "E2EMSL") {
                    this.newObj.trainE2ESLDataPathList.push(...searchResult.trainE2ESLDataPathList);
                    this.newObj.trainE2ESLWavPathList.push(...searchResult.trainE2ESLWavPathList);
                    this.newObj.trainE2EUSLWavPathList.push(...searchResult.trainE2EUSLWavPathList);

                  } else if (this.updateModelType == "E2EUSL") {
                    this.newObj.trainE2EUSLWavPathList.push(...searchResult.trainE2EUSLWavPathList);
                  }
                } else {
                  $amDatasetUpdateInput.hide();
                }
                break;
              } // End if currentId == searchResult.id

            } // End for


          },

          showHideDatasetList: function () {
            var chkDiv = $("#amDatasetDiv").is(':visible');
            if (chkDiv) {
              $("#amDatasetDiv").hide();
            } else {
              $("#amDatasetDiv").show();
            }
          },
          initServiceModel: function () {

            // insert, select에 서비스 추가
            var ulHtmlStr = '';
            ulHtmlStr += `
                            <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected"
                                aria-selected
                                data-value="0">
                                <span class="mdc-deprecated-list-item__ripple"></span>
                                <span class="mdc-deprecated-list-item__text">"선택"</span>
                            </li>`

            for (var i = 0; i < this.serviceModelList.length; i++) {
              var serviceModel = this.serviceModelList[i];

              var htmlStr = `
                            <li class="mdc-deprecated-list-item" data-value="${serviceModel.serviceCode}">
                                <span class="mdc-deprecated-list-item__ripple"></span>
                                <span class="mdc-deprecated-list-item__text">${serviceModel.serviceModelName}</span>
                            </li>`
              ulHtmlStr += htmlStr;
              this.SERVICE_MODEL_ID_TO_NAME[serviceModel.serviceCode] = serviceModel.serviceModelName;
            }

            $("#insert-serviceModel-mdc-select ul").html(ulHtmlStr)
          },
          // 학습등록 팝업창에 모델타입 select 추가
          initModelType: function () {
            var ulHtmlStr = '';
            ulHtmlStr += `
                            <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected" aria-selected data-value="0">
                                <span class="mdc-deprecated-list-item__ripple"></span>
                                <span class="mdc-deprecated-list-item__text">"선택"</span>
                            </li>`

            for (var i = 0; i < this.modelTypes.length; i++) {
              var selectModelType = this.modelTypes[i];

              var htmlStr = `
                            <li class="mdc-deprecated-list-item" data-value="${selectModelType.key}">
                                <span class="mdc-deprecated-list-item__ripple"></span>
                                <span class="mdc-deprecated-list-item__text">${selectModelType.value}</span>
                            </li>`
              ulHtmlStr += htmlStr;

              this.modelTypeToName[selectModelType.key] = selectModelType.value;
            }

            $("#insert-modelType-mdc-select ul").html(ulHtmlStr)
            //$("#update-modelType-mdc-select ul").html(ulHtmlStr)
          },

          initStatus: function (callback) {
            this.statuses = {...LABEL.trainStatuses};

            callback();
          },

          // 검색
          search: function (isSearchBtnClicked) {
            this._setSearching(true);

            var searchConditions = {...this.searchCondition}

            if (isSearchBtnClicked) {
              searchConditions['pageNum'] = 1;
            } else {
              searchConditions['pageNum'] = this.currentPage;
            }

            commonObject.deleteNullOrDefaultFields(searchConditions);
            var queryString = Qs.stringify(searchConditions);

            $.ajax({
              url: this.baseUrl + "/train/api/listPage?" + queryString,
              method: "get",
              contentType: 'application/json; charset=UTF-8',
              dataType: "json"
            }).done(data => {
              this._setSearchResultsPageInfo(data); // 검색 결과 페이지 정보 저장
              this._setSearchResults(data.result); // 검색 결과 목록
            }).always(() => {
              this._setSearching(false);
            })
          },

          // 상세
          detail: function (trainId, callback) {
            $.ajax({
              url: this.baseUrl + "/train/api/" + trainId,
              method: "get",
              contentType: 'application/json; charset=UTF-8',
              dataType: "json",
            }).done(result => {
              this.detailObj = {...result.result};

              callback();
            });
          },

          // 등록
          insert: function (e) {
            //if (!this.validateInsert()) {
            //  return;
            //}
            if (this.newObj.modelType == "E2ESL" || this.newObj.modelType == "E2EMSL" || this.newObj.modelType == "E2EUSL") {
              this.chkDatasetListSet();
            }


            var newObj = {...this.newObj}

            if (confirm("등록하시겠습니까?")) {
              this.setDialogLoading(this.trainDialogLoadingBar, true);
              let apiUrl = this.baseUrl + "/train/api/insert";
              this.checkXhrAbort = true;
              this.dispatchProcessing('process');
              var self = this;
              let xhr = $.ajax({
                url: apiUrl,
                method: "post",
                contentType: 'application/json; charset=UTF-8',
                dataType: "json",
                data: JSON.stringify(newObj)
              }).done(result => {
                if (result.resultCode == "0000") {
                  toastr.success(result.resultMsg);
                  self.insertDialog.close();
                } else {
                  toastr.error(result.resultMsg);
                }
              }).always(() => {
                this.setDialogLoading(this.trainDialogLoadingBar, false);
                this.search();
                // 배열에서 해당 xhr 제거 및 checkXhrAbort 초기화
                let result = self.currentXhr.find(obj => obj.id === apiUrl);
                if (result) {
                  let index = self.currentXhr.indexOf(result);
                  self.currentXhr.splice(index, 1);
                }
                self.checkXhrAbort = false;
                self.dispatchProcessing('done');
              });
              // abort 적용을 위해 xhr 객체에 id를 추가해 배열에 push
              let result = {id: apiUrl, xhr};
              self.currentXhr.push(result);
            }

            e.preventDefault();
            e.stopPropagation();
          },

          // 재등록
          update: function (e) {

            var newObj = {...this.newObj}
            newObj.serviceModelId = this.updateServiceModelId;
            newObj.modelType = this.updateModelType

            // abort 적용할 대상엔 true로 설정
            let apiUrl = this.baseUrl + "/train/api/update";

            if (confirm("재등록하시겠습니까?")) {
              this.setDialogLoading(this.reTrainDialogLoadingBar, true);
              this.checkXhrAbort = true;
              this.dispatchProcessing('process');
              var self = this;
              let xhr = $.ajax({
                url: apiUrl,
                method: "post",
                contentType: 'application/json; charset=UTF-8',
                dataType: "json",
                data: JSON.stringify(newObj)
              }).done(result => {
                if (result.resultCode == "0000") {
                  toastr.success(result.resultMsg);
                  self.updateDialog.close();
                } else {
                  toastr.error(result.resultMsg);
                }
              }).always(() => {
                this.setDialogLoading(this.reTrainDialogLoadingBar, false);
                this.search();
                // 배열에서 해당 xhr 제거 및 checkXhrAbort 초기화
                let result = self.currentXhr.find(obj => obj.id === apiUrl);
                if (result) {
                  let index = self.currentXhr.indexOf(result);
                  self.currentXhr.splice(index, 1);
                }
                self.checkXhrAbort = false;
                self.dispatchProcessing('done');
              });
              // abort 적용을 위해 xhr 객체에 id를 추가해 배열에 push
              let result = {id: apiUrl, xhr};
              self.currentXhr.push(result);
            }

            e.preventDefault();
            e.stopPropagation();
          },

          // 재등록
          detailUpdate: function (e) {

            var detailObj = {...this.detailObj}
            // detailObj.description = this.description;

            // abort 적용할 대상엔 true로 설정
            let apiUrl = this.baseUrl + "/train/api/detailUpdate";

            if (confirm("수정하시겠습니까?")) {
              this.setDialogLoading(this.reTrainDialogLoadingBar, true);
              this.checkXhrAbort = true;
              this.dispatchProcessing('process');
              var self = this;
              let xhr = $.ajax({
                url: apiUrl,
                method: "post",
                contentType: 'application/json; charset=UTF-8',
                dataType: "json",
                data: JSON.stringify(detailObj)
              }).done(result => {
                if (result.resultCode == "0000") {
                  toastr.success(result.resultMsg);
                  self.detailDialog.close();
                } else {
                  toastr.error(result.resultMsg);
                }
              }).always(() => {
                this.setDialogLoading(this.reTrainDialogLoadingBar, false);
                this.search();
                // 배열에서 해당 xhr 제거 및 checkXhrAbort 초기화
                let result = self.currentXhr.find(obj => obj.id === apiUrl);
                if (result) {
                  let index = self.currentXhr.indexOf(result);
                  self.currentXhr.splice(index, 1);
                }
                self.checkXhrAbort = false;
                self.dispatchProcessing('done');
              });
              // abort 적용을 위해 xhr 객체에 id를 추가해 배열에 push
              let result = {id: apiUrl, xhr};
              self.currentXhr.push(result);
            }

            e.preventDefault();
            e.stopPropagation();
          },

          status: function (trainId) {
            if (confirm("상태 조회를 하시겠습니까?")) {
              var self = this;
              const $rowEl = $("#row-" + trainId);
              $rowEl.addClass("synchronizing");

              $.ajax({
                url: this.baseUrl + "/train/api/status?id=" + trainId,
                method: "get",
                contentType: 'application/json; charset=UTF-8',
                dataType: "json"
              }).done(data => {
                if (data.resultCode !== "0000") {
                  toastr.error(data.resultMsg);
                  return;
                }
                $("#status" + trainId).animate({'opacity': 0}, 100, function () {
                  $("#status" + trainId).animate({'opacity': 1}, 300);
                });
                let currentRow = self.searchResults.find(row => row.id === trainId);
                currentRow.status = data.result;
              }).always(() => {
                $rowEl.removeClass("synchronizing");
                $rowEl.addClass("is-done");
                setTimeout(() => {
                  $rowEl.removeClass("is-done")
                }, 700)
              })
            }
          },

          // 등록 팝업 초기화
          initializeInsertDialog: function () {

            var $insertServiceModelElement = $("#insert-serviceModel-mdc-select")[0];
            $($insertServiceModelElement).data('instance').setSelectedIndex(0);
            // 모델타입
            var $insertModelTypeElement = $("#insert-modelType-mdc-select")[0];
            $($insertModelTypeElement).data('instance').setSelectedIndex(0);

            // AM데이터셋 체크박스 초기화
            this.amDatasetList = [];
            var chkDiv = $("#amDatasetDiv").is(':visible');
            if (chkDiv) {

              $("#amDatasetDiv").hide();
              var checkboxList = $('input.chk-am-dataset');
              for (var checkbox of checkboxList) {
                var datasetId = $(checkbox).val();
                var checked = $().is(":checked");
                $(checkbox).prop("checked", false);
              }
            }

            // 설명
            $($('#insert-description-input')[0].parentElement).data('instance').value = '';
            this._showValidationHelperLine('', $("#insert-description-helper-line"), '설명');
          },

          // 재등록 팝업 초기화
          initializeUpdateDialog: function () {

            설명
            $($('#update-description-input')[0].parentElement).data('instance').value = '';
            this._showValidationHelperLine('', $("#update-description-helper-line"), '설명');
          },

          // 상세 팝업 초기화
          initializeDetailDialog: function () {

            // 서비스 모델
            $($('#detail-service-model')[0].parentElement).data('instance').value = this.convertServiceModelId2Name(this.detailObj.serviceModelId);

            // 설명
            $($('#detail-description')[0].parentElement).data('instance').value = this.convertString(this.detailObj.description);
            this._showValidationHelperLine('', $("#detail-description-helper-line"), '설명');

            // 작성자
            $($('#detail-created-by')[0].parentElement).data('instance').value = this.convertString(this.detailObj.updatedBy);

            // 요청날짜
            $($('#detail-requested-at')[0].parentElement).data('instance').value = this.convertString(this.detailObj.requestedAt);

            // 종료날짜
            $($('#detail-completed-at')[0].parentElement).data('instance').value = this.convertString(this.detailObj.completedAt);

            // 경과시간
            //$($('#detail-duration')[0].parentElement).data('instance').value = this.convertString(this.detailObj.duration);

            // 상태
            $($('#detail-status')[0].parentElement).data('instance').value = this.convertString(this.detailObj.status);

            // 실패 원인
            $($('#detail-result-msg')[0].parentElement).data('instance').value = this.convertString(this.detailObj.resultMsg);

            // 학습 데이터 양
            if (this.detailObj.modelType == "CLASS" || this.detailObj.modelType == "SERVICE" || this.detailObj.modelType == "E2ELM") {
              $($('#detail-data-num')[0].parentElement).data('instance').value = this.convertString(this.detailObj.dataNum) + "건";
            } else {
              $($('#detail-data-num')[0].parentElement).data('instance').value = this.convertString(this.detailObj.dataTime);
            }


            // 모델 ID
            $($('#detail-result-model-id')[0].parentElement).data('instance').value = this.convertString(this.detailObj.resultModelId);
          },

          // 검색 이벤트
          initSearchBarEvents: function () {
            var self = this;
            $('.search-bar input').on("keydown", function (e) {
              if (e.keyCode == 13) {
                self.search(true);
              }
            });
          },

          _setSearchResults: function (result) {
            this.searchResults = result;
          },
          _setSearchResultsPageInfo: function (data) {
            this.pageInfo.pages = data.pages;
            this.pageInfo.total = data.total;
            this.currentPage = data.pageNum;
          },
          _setSearching: function (searching) {
            this.searching = searching;
          },

          // 페이지네이션
          gotoPage: function (pageNum) {
            let validPageNum = pageNum;
            if (pageNum < 1) {
              validPageNum = 1;
            } else if (pageNum > this.pageInfo.pages) {
              validPageNum = this.pageInfo.pages;
            }

            this.currentPage = validPageNum;
            this.search();
          },

          // insert 이벤트
          onChangeInsertServiceModel: function (e) {
            this.newObj.serviceModelId = $(e.target).data('instance').value;
            var chkDiv = $("#amDatasetDiv").is(':visible');

            if (this.newObj.modelType != null && this.newObj.modelType != undefined && this.newObj.modelType != 0) {
              if (this.newObj.modelType == "E2ESL" || this.newObj.modelType == "E2EMSL" || this.newObj.modelType == "E2EUSL") {
                this.initAmDatasetList();
              } else {
                if (chkDiv) {
                  $("#amDatasetDiv").hide();
                }
              }
            }
          },
          onChangeInsertDescription: function (e) {
            var newDescription = e.target.value;
            //e.target.value = newDescription;

            var $helperLine = $("#insert-description-helper-line")

            if (this.validateDescription(e.target.value)) {
              this._showValidationHelperLine("VALID", $helperLine, "설명");
              this.newObj.description = newDescription;
            } else {
              this._showValidationHelperLine("INVALID", $helperLine, "설명");
              e.target.focus();
            }
          },
          onChangeInsertModelType: function (e) {
            this.newObj.modelType = $(e.target).data('instance').value;
            this.newObj.serviceModelId = $("#insert-serviceModel-mdc-select").data('instance').value;
            var chkDiv = $("#amDatasetDiv").is(':visible');

            if (this.newObj.serviceModelId != null && this.newObj.serviceModelId != undefined && this.newObj.serviceModelId != 0) {
              if (this.newObj.modelType == "E2ESL" || this.newObj.modelType == "E2EMSL" || this.newObj.modelType == "E2EUSL") {
                this.initAmDatasetList();
              } else {
                if (chkDiv) {
                  $("#amDatasetDiv").hide();
                }
              }
            } else {
              $("#amDatasetDiv").hide();
            }

            //this.refreshAmDatasetList();
          },
          onClickInsertDatasetCheckbox: function (e) {

            //this.newObj.useServer = e.target.checked;
          },
          onChangeUpdateDialogDescription: function (e) {
            var newDescription = e.target.value;
            //e.target.value = newDescription;

            var $helperLine = $("#update-description-helper-line")

            if (this.validateDescription(e.target.value)) {
              this._showValidationHelperLine("VALID", $helperLine, "설명");
              this.newObj.description = newDescription;
            } else {
              this._showValidationHelperLine("INVALID", $helperLine, "설명");
              e.target.focus();
            }
          },
          onChangeDetailDialogDescription: function (e) {
            var newDescription = e.target.value;
            //e.target.value = newDescription;

            var $helperLine = $("#detail-description-helper-line")

            if (this.validateDescription(e.target.value)) {
              this._showValidationHelperLine("VALID", $helperLine, "설명");
              this.detailObj.description = newDescription;
            } else {
              this._showValidationHelperLine("INVALID", $helperLine, "설명");
              e.target.focus();
            }
          },
          _showValidationHelperLine: function (mode, $helperline, key) {
            if (mode == "VALID") {
              $helperline.html(
                `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--success">
                                                        사용 가능한 ${key}입니다.
                                                    </p>`
              )
            } else if (mode == "INVALID") {
              $helperline.html(
                `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--error ">
                                                        유효하지 않은 ${key}입니다.
                                                    </p>`
              )
            } else {
              $helperline.html('<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg "></p>');
            }
          },
          onChangeUpdateDescription: function (e) {
            var newObj = e.target.value;
            //e.target.value = newObj;

            var $helperLine = $("#detail-description-helper-line")

            if (this.validateDescription(e.target.value)) {
              this._showValidationHelperLine("", $helperLine, "설명");
            } else {
              this._showValidationHelperLine("INVALID", $helperLine, "설명");
              e.target.focus();
            }

            this.detailObj.description = newObj;
          },

          // 유효성 검사 (액션별)
          validateInsert: function () {
            // 서비스 모델
            if (this.newObj.serviceModelId == null || this.newObj.serviceModelId == undefined || this.newObj.serviceModelId == 0) {
              toastr.error("서비스 모델을 선택해주세요.")
              return;
            }

            // 설명
            if (!this.validateDescription($($("#insert-description-input")[0].parentElement).data('instance').value)) {
              toastr.error("설명은 최대" + this.DESCRIPTION_MAX_LENGTH + "자 까지 입력 가능합니다.")
              return;
            }

            // 모델타입
            if (this.newObj.modelType == null || this.newObj.modelType == undefined || this.newObj.modelType == 0) {
              toastr.error("모델타입을 선택해주세요.")
              return;
            }

            return true;
          },

          validateDescription: function (value) {
            // 최대 글자
            var newValue = value.trim();
            return newValue.length <= this.DESCRIPTION_MAX_LENGTH;
          },

          chkDatasetListSet: function () { // 체크된 데이터셋 리스트 담기
            var datasetIdList = $.map($(".chk-am-dataset:checked"), function (item) {
              return $(item).val();
            });

            var checkboxList = $('input.chk-am-dataset');
            for (var checkbox of checkboxList) {

              var datasetId = $(checkbox).val();
              var checked = $(checkbox).is(":checked");
              if (checked) {

                for (var i = 0; i < this.amDatasetList.length; i++) {
                  if (datasetId == this.amDatasetList[i].id) {
                    if (this.newObj.modelType == "E2ESL") {
                      this.newObj.trainE2ESLDataPathList.push(this.amDatasetList[i].amDataPath + this.amDatasetList[i].answerFileName);
                      this.newObj.trainE2ESLWavPathList.push(this.amDatasetList[i].amDataPath + this.amDatasetList[i].voiceFileName);

                      this.newObj.trainAmDatasetList.push(this.amDatasetList[i].datasetName);
                    } else if (this.newObj.modelType == "E2EMSL") {
                      this.newObj.trainE2ESLDataPathList.push(this.amDatasetList[i].amDataPath + this.amDatasetList[i].answerFileName);
                      this.newObj.trainE2ESLWavPathList.push(this.amDatasetList[i].amDataPath + this.amDatasetList[i].voiceFileName);
                      this.newObj.trainE2EUSLWavPathList.push(this.amDatasetList[i].amDataPath + this.amDatasetList[i].voiceFileName);

                      this.newObj.trainAmDatasetList.push(this.amDatasetList[i].datasetName);
                    } else if (this.newObj.modelType == "E2EUSL") {
                      this.newObj.trainE2EUSLWavPathList.push(this.amDatasetList[i].amDataPath + this.amDatasetList[i].voiceFileName);

                      this.newObj.trainAmDatasetList.push(this.amDatasetList[i].datasetName);
                    }
                  } // End if(datasetId == this.amDatasetList[i].id)

                } // End for(var i=0; i<this.amDatasetList.length; i++)

              } // End if(checked)

            } // End for(var checkbox of checkboxList)

          },

          // 상세 페이지 오픈
          openDetailDialog: function (trainId) {
            var self = this;
            this.detail(trainId, () => self.detailDialog.open());
          },
          // 재등록 페이지 오픈
          openUpdateDialog: function (id, serviceModelId, modelType) {
            this.currentDialog = 'updateDialog';

            var self = this;
            // 서비스 모델
            $($('#update-service-model')[0].parentElement).data('instance').value = this.SERVICE_MODEL_ID_TO_NAME[serviceModelId];
            self.updateServiceModelId = serviceModelId;

            // 모델타입
            $($('#update-modelType')[0].parentElement).data('instance').value = this.modelTypeToName[modelType];
            self.updateModelType = modelType;

            // 데이터셋
            this.getPreviousDataset(id);

            // 설명
            //$($('#update-description-input')[0].parentElement).data('instance').value = '';
            //this._showValidationHelperLine('', $("#update-description-helper-line"), '설명');
            self.updateDialog.open();
          },
          // 모델 다운로드
          requestResultModelDownload: function (resultModelId) {
            if (confirm("모델 다운로드를 하시겠습니까?\r\n대용량 파일은 시간이 소요 될 수 있으니 기다려주시기 바랍니다.")) {
              var self = this;

              $.ajax({
                url: this.baseUrl + "/resultmodelid/api/check?resultModelId=" + resultModelId,
                method: "get",
                contentType: 'application/json; charset=UTF-8',
                dataType: "json"
              }).done(data => {
                if (data.result == true) {
                  // var downloadLink = document.createElement("a");
                  // downloadLink.href = this.baseUrl + '/resultmodelid/api/download?resultModelId=' + resultModelId;
                  // downloadLink.download = "data.csv";
                  //
                  // document.body.appendChild(downloadLink);
                  // downloadLink.click();
                  // document.body.removeChild(downloadLink);
                  this.downloadResultModel(resultModelId)
                } else {
                  toastr.error("파일이 존재하지 않습니다.");
                }
              })
            }
          },
          downloadResultModel: function (resultModelId) {
            $.ajax({
              url: this.baseUrl + '/resultmodelid/api/download?resultModelId=' + resultModelId,
              type: 'GET',
              cache: false,
              xhrFields: {
                responseType: "blob",
              },
              success: function (data, textStatus, jqXHR) {
                if (jqXHR.readyState == 4 && jqXHR.status == 200) {
                  let filename = resultModelId + ".zip";
                  let blob = new Blob([data], {type: "application/octetstream"});
                  let link = document.createElement('a');
                  link.href = window.URL.createObjectURL(blob);
                  link.download = filename;
                  link.click();
                } else {
                  toastr.error("모델 다운로드에 실패했습니다.")
                }
              },
              error: function (jqXHR, textStatus, errorThrown) {
                toastr.error("모델 다운로드에 실패했습니다.")
              },
              complete: function () {

              }
            });
          },
          convertServiceModelId2Name: function (id) {
            return this.SERVICE_MODEL_ID_TO_NAME[id];
          },
          convertString: function (s) {
            return s === null ? "" : s;
          },
          setDialogLoading: function (loadingBarJqueryEl, option) {
            if (option == true) {
              loadingBarJqueryEl.show();
              return;
            }
            loadingBarJqueryEl.hide();
          },

          /**
           * 모달 닫을 때 데이터 요청/전송 취소
           */
          onCloseDialog: function () {
            const self = this;
            if (self.currentXhr.length !== 0) {
              if (self.checkXhrAbort && !confirm('취소 시 저장 및 업로드가 중단됩니다.')) return;
              [...self.currentXhr].forEach(xhrItem => xhrItem.xhr.abort())
              self.dispatchProcessing('done');
            }
            if (self.currentDialog) {
              self[self.currentDialog].close();
              self.currentDialog = null;
            }
          },

          /**
           *
           * @param state: 'process' || 'done'
           * 디스패치 시 모달 본문에 유저 동작 방지 적용 및 닫기/취소를 제외한 버튼 비활성화
           */
          dispatchProcessing: function (state) {
            let $modalSurface;
            let $modalBtn;
            if (state === 'process') {
              // 닫기/취소를 제외한 버튼 선택
              $modalBtn = $('.mdc-dialog--open .mdc-dialog__surface .mdc-button').not('.close-button');
              // 현재 열려있는 모달 선택
              $modalSurface = $('.mdc-dialog--open .mdc-dialog__surface');
              $modalBtn.prop('disabled', true);
              $modalSurface.addClass('is-processing');
            } else if (state === 'done') {
              // 진행 중인 모달 선택.
              // 모달 닫는게 먼저 실행되면 .mdc-dialog--open으로 선택 불가
              $modalBtn = $('.mdc-dialog__surface.is-processing .mdc-button').not('.close-button');
              $modalSurface = $('.mdc-dialog__surface.is-processing');
              $modalBtn.prop('disabled', false);
              $modalSurface.removeClass('is-processing');
            }
          },
        }
      });
    })();
  </script>
</th:block>

</html>

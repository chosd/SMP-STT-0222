<!DOCTYPE html>
<html lang="ko"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="layouts/nolayout">
<th:block layout:fragment="html">
	<div class="contentRoot">
		<div class="content-header">
			<h2>LM 학습데이터 관리</h2>
			<div class="button-group">
				<!--대량 등록-->
				<button id="insert-bulk-dialog-btn" class="mdc-button mdc-button--outlined mdc-ripple-upgraded">
					<span class="mdc-button__ripple"></span>
					<i class="material-icons mdc-button__icon me-1">add</i>
					<span class="mdc-button__label">대량등록</span>
				</button>
				<!--등록-->
				<button id="insert-dialog-btn" class="mdc-button mdc-button--outlined mdc-ripple-upgraded">
					<span class="mdc-button__ripple"></span>
					<i class="material-icons mdc-button__icon me-1">add</i>
					<span class="mdc-button__label">등록</span>
				</button>
			</div>
		</div>
		<div class="content-body">
			<div class="card">
				<div class="card-header pb-4">
					<div class="form-row md-size multiline-align-top">
						<!-- >> 데이터 구분 검색 -->
						<div class="mdc-select mdc-select--outlined mdc-select--no-label" id="dataTypes-mdc-select">
								<div class="mdc-select__anchor">
									<div class="mdc-notched-outline">
										<span class="mdc-notched-outline__leading"></span>
										<div class="mdc-notched-outline__notch">
											<label class="mdc-floating-label">데이터 구분</label>
										</div>
										<span class="mdc-notched-outline__trailing"></span>
									</div>
									<span class="mdc-select__selected-text-container overflow-hidden">
										<span class="mdc-select__selected-text"></span>
									</span>
									<span class="mdc-select__dropdown-icon"></span>
								</div>

								<div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
									<ul class="mdc-deprecated-list">
										<li v-for="sp in dataTypes" class="mdc-deprecated-list-item"
											:data-value="sp.key"
											@click="searchCondition.dataType = sp.key"
											:class="{'mdc-deprecated-list-item--selected': searchCondition.dataType == sp.key} "
											:aria-selected="searchCondition.dataType == sp.key ? 'true' : 'false'">
											<span class="mdc-deprecated-list-item__ripple"></span>
											<span class="mdc-deprecated-list-item__text">{{ sp.value }}</span>
										</li>
									</ul>
								</div>
							</div>
						<!-- << 데이터 구분 검색 -->

						<!-- >> 서비스 모델 검색 -->
						<div class="mdc-select mdc-select--outlined mdc-select--no-label" id="serviceModels-mdc-select">
							<div class="mdc-select__anchor">
								<div class="mdc-notched-outline">
									<span class="mdc-notched-outline__leading"></span>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">서비스 모델</label>
									</div>
									<span class="mdc-notched-outline__trailing"></span>
								</div>
								<span class="mdc-select__selected-text-container overflow-hidden">
									<span class="mdc-select__selected-text"></span>
								</span>
								<span class="mdc-select__dropdown-icon"></span>
							</div>
							<div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
								<ul class="mdc-deprecated-list">
									<li v-for="sp in serviceModels" class="mdc-deprecated-list-item"
										:data-value="sp.key"
										@click="searchCondition.serviceModelId = sp.key"
										:class="{'mdc-deprecated-list-item--selected': searchCondition.serviceModelId == sp.key} "
										:aria-selected="searchCondition.serviceModelId == sp.key ? 'true' : 'false'">
										<span class="mdc-deprecated-list-item__ripple"></span>
										<span class="mdc-deprecated-list-item__text">{{ sp.value }}</span>
									</li>
								</ul>
							</div>
						</div>
						<!-- << 서비스 모델 검색 -->

						<!-- << 학습데이터 검색 -->
						<div class="mdc-text-field text-field mdc-text-field--outlined flex-auto search-bar">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text"
									   v-model="searchCondition.contents"/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">학습데이터</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
						<!-- << 학습데이터 검색 -->

						<!-- << 작성자 검색 -->
						<div class="mdc-text-field text-field mdc-text-field--outlined flex-auto search-bar">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text"
									   v-model="searchCondition.uploadedBy"/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">작성자</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
						<!-- << 작성자 검색 -->

						<!-- << 설명 검색 -->
						<div class="mdc-text-field text-field mdc-text-field--outlined flex-auto search-bar">
							<input type="text" class="mdc-text-field__input"
										 aria-describedby="text-field-outlined-shape-one-helper-text"
										 v-model="searchCondition.description"/>
							<div class="mdc-notched-outline mdc-notched-outline--upgraded">
								<div class="mdc-notched-outline__leading"></div>
								<div class="mdc-notched-outline__notch">
									<label class="mdc-floating-label">설명</label>
								</div>
								<div class="mdc-notched-outline__trailing"></div>
							</div>
						</div>
						<!-- << 설명 검색 -->

						<!-- >> 등록일 검색 -->
						<div class="flex-auto flex-ratio-two">
							<div class="form-row h-100">
								<div id="from-date-mdc" class="mdc-text-field text-field mdc-text-field--outlined mdc-text-field--with-leading-icon flex-auto">
									<i class="material-icons mdc-text-field__icon">event</i>
									<input type="text" class="mdc-text-field__input" aria-describedby="text-field-outlined-shape-one-helper-text"/>
									<div class="mdc-notched-outline mdc-notched-outline--upgraded">
										<div class="mdc-notched-outline__leading"></div>
										<div class="mdc-notched-outline__notch">
											<label class="mdc-floating-label" >등록일(from)</label>
										</div>
										<div class="mdc-notched-outline__trailing"></div>
									</div>
								</div>
								<div id="to-date-mdc" class="mdc-text-field text-field mdc-text-field--outlined mdc-text-field--with-leading-icon flex-auto">
									<i class="material-icons mdc-text-field__icon">event</i>
									<input type="text" class="mdc-text-field__input" aria-describedby="text-field-outlined-shape-one-helper-text"/>
									<div class="mdc-notched-outline mdc-notched-outline--upgraded">
										<div class="mdc-notched-outline__leading"></div>
										<div class="mdc-notched-outline__notch">
											<label class="mdc-floating-label" >등록일(to)</label>
										</div>
										<div class="mdc-notched-outline__trailing"></div>
									</div>
								</div>
							</div>
							<div class="mdc-text-field-helper-line">
								<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg">
									등록일이 없는 경우는 전체 기간을 뜻합니다.
								</p>
							</div>
						</div>
						<!-- << 등록일 검색 -->

						<!-- << 검색 버튼 -->
						<button class="mdc-button mdc-button--unelevated mdc-ripple-upgraded" @click="search">
							<span class="mdc-button__ripple"></span>
							<i class="material-icons mdc-button__icon me-1">search</i>
							<span class="mdc-button__label">검색</span>
						</button>
						<!-- << 검색 버튼 -->
					</div>
				</div>

				<div class="card-body">
					<div class="table-controls form-row md-size">
						<!--검색 결과-->
						<div class="table-result-info flex-auto">
							<h4>검색결과 : <span>{{ pageInfo.total }}</span>건</h4>
						</div>

						<!--엑셀 다운로드-->
						<button class="mdc-button mdc-button--outlined mdc-ripple-upgraded"
								@click="downloadListExcel">
							<span class="mdc-button__ripple"></span>
							<i class="material-icons mdc-button__icon me-1">file_download</i>
							<span class="mdc-button__label">다운로드</span>
						</button>

						<!--일괄 삭제-->
						<button id="delete-dialog-btn"
								class="mdc-button mdc-button--outlined mdc-ripple-upgraded mdc-theme--error">
							<span class="mdc-button__ripple"></span>
							<i class="material-icons mdc-button__icon">delete</i>
							<span class="mdc-button__label">일괄 삭제</span>
						</button>

						<!--선택 삭제-->
						<button
							class="mdc-button mdc-button--outlined mdc-ripple-upgraded mdc-theme--error"
							@click="deleteSelected">
							<span class="mdc-button__ripple"></span>
							<i class="material-icons mdc-button__icon">delete</i>
							<span class="mdc-button__label">선택 삭제</span>
						</button>

						<!-- >>> 페이지 사이즈 조절 -->
                        <div class="mdc-select mdc-select--outlined mdc-select--no-label">
                            <div class="mdc-select__anchor">
                                <div class="mdc-notched-outline">
                                    <span class="mdc-notched-outline__leading"></span>
                                    <div class="mdc-notched-outline__notch">
                                        <label class="mdc-floating-label">레코드 수</label>
                                    </div>
                                    <span class="mdc-notched-outline__trailing"></span>
                                </div>
                                <span class="mdc-select__selected-text-container overflow-hidden">
                                    <span class="mdc-select__selected-text"></span>
                                </span>
                                <span class="mdc-select__dropdown-icon"></span>
                            </div>
                            <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
                                <ul class="mdc-deprecated-list">
                                    <li v-for="ps in pageSizes" class="mdc-deprecated-list-item"
                                        :data-value="ps"
                                        @click="searchCondition.pageSize = ps; currentPage = 1; search();"
                                        :class="{'mdc-deprecated-list-item--selected': searchCondition.pageSize == ps} "
                                        :aria-selected="searchCondition.pageSize === ps ? 'true' : 'false'">
                                        <span class="mdc-deprecated-list-item__ripple"></span>
                                        <span class="mdc-deprecated-list-item__text">{{ ps }}개</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
					</div>

					<!-- 목록 테이블 -->
					<div class="table-container">
						<div class="mdc-data-table">
							<div class="mdc-data-table__table-container">
								<table class="mdc-data-table__table">
									<thead>
									<tr class="mdc-data-table__header-row">
										<th class="mdc-data-table__header-cell mdc-data-table__header-cell--checkbox text-center" role="columnheader" scope="col">
											<div class="mdc-form-field">
												<div
													class="mdc-checkbox mdc-data-table__header-row-checkbox mdc-checkbox--upgraded mdc-checkbox--selected mdc-ripple-upgraded mdc-ripple-upgraded--unbounded">
													<input type="checkbox" class="mdc-checkbox__native-control" aria-checked="mixed"
														   @click="selectAllRows" id="toggleDelete"/>
													<div class="mdc-checkbox__background">
														<svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
															<path class="mdc-checkbox__checkmark-path" fill="none"
																  d="M1.73,12.91 8.1,19.28 22.79,4.59"></path>
														</svg>
														<div class="mdc-checkbox__mixedmark"></div>
													</div>
													<div class="mdc-checkbox__ripple"></div>
												</div>
											</div>
										</th>
										<th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">No.</th>
										<th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">데이터 구분</th>
										<th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">서비스 모델</th>
										<th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">학습데이터</th>
										<th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">가중치</th>
										<th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">설명</th>
										<th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">작성자</th>
										<th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">등록일시</th>
										<th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">수정일시</th>
									</tr>
									</thead>
									<tbody class="mdc-data-table__content">
									<tr v-if="searchResults.length == 0" class="mdc-data-table__row" aria-selected="false"
										style="cursor: pointer;">
										<td class="mdc-data-table__cell text-center" colspan="10">검색된 결과가 없습니다.</td>
									</tr>
									<tr v-else v-for="(row, i) in searchResults" class="detail-service-row mdc-data-table__row"
										aria-selected="false" style="cursor: pointer;">
										<td class="mdc-data-table__cell mdc-data-table__cell--checkbox">
											<div
												class="mdc-checkbox mdc-data-table__row-checkbox mdc-checkbox--upgraded mdc-ripple-upgraded mdc-ripple-upgraded--unbounded">
												<input type="checkbox" class="mdc-checkbox__native-control deleteChk"
													   aria-labelledby="u60" :value="row.id"/>
												<div class="mdc-checkbox__background">
													<svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
														<path class="mdc-checkbox__checkmark-path" fill="none"
															  d="M1.73,12.91 8.1,19.28 22.79,4.59"></path>
													</svg>
													<div class="mdc-checkbox__mixedmark"></div>
												</div>
												<div class="mdc-checkbox__ripple"></div>
											</div>
										</td>
										<td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
											{{ pageInfo.total - ( (currentPage - 1) * searchCondition.pageSize + i) }}
										</td>
										<td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
											{{ convertDataTypeLabel(row.dataType) }}
										</td>
										<td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
											{{ convertServiceModelLabel(row.serviceModelId) }}
										</td>
										<td class="mdc-data-table__cell" @click="() => openDetailDialog(row.id)">
											{{ row.contents }}
										</td>
										<td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
											{{ row.repeatCount }}
										</td>
										<td class="mdc-data-table__cell" @click="() => openDetailDialog(row.id)">
											{{ row.description }}
										</td>
										<td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
											{{ row.regId }}
										</td>
										<td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
											{{ row.regDt }}
										</td>
										<td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
											{{ row.updDt }}
										</td>
									</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<!-- pagination -->
					<div class="table-pagination mdc-data-table__pagination">
						<div class="mdc-data-table__pagination-trailing mdc-chip-set mdc-chip-set--choice">
							<div class="mdc-data-table__pagination-navigation">
								<button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
										data-first-page="true" @click="gotoPage(1)">
									<div class="mdc-button__icon">first_page</div>
								</button>
								<button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
										data-prev-page="true" @click="gotoPage(currentPage - 1)">
									<div class="mdc-button__icon">chevron_left</div>
								</button>

								<button v-for="(paging, index) in pages"
										class="mdc-chip mdc-data-table__pagination-button fs-6 bg-transparent"
										:class="{ 'mdc-chip--selected' : paging == currentPage }"
										@click="gotoPage(paging)">
									{{ paging }}
								</button>
								<button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
										data-next-page="true" @click="gotoPage(currentPage + 1)">
									<div class="mdc-button__icon">chevron_right</div>
								</button>
								<button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
										data-last-page="true" @click="gotoPage(pageInfo.pages)">
									<div class="mdc-button__icon">last_page</div>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- >>> 등록 팝업 -->
	<div id="insert-dialog" class="mdc-dialog" role="alertdialog" aria-modal="true"
		 aria-labelledby="simple-dialog-label" aria-describedby="simple-dialog-description" tabindex="-1">
		<div class="mdc-dialog__scrim"></div>
		<div class="mdc-dialog__container">
			<div class="mdc-dialog__surface">
				<div class="mdc-dialog__header">
					<h2 class="mdc-dialog__title">LM 학습데이터 등록</h2>
					<button class="mdc-icon-button material-icons close-button" tabindex="-1">
						close
					</button>
				</div>
				<!-- loading bar -->
                <div id="insert-dialog-loadingbar" role="progressbar" class="mdc-linear-progress mdc-linear-progress--indeterminate" style="opacity: 0;">
                    <div class="mdc-linear-progress__buffering-dots"></div>
                    <div class="mdc-linear-progress__buffer"></div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                        <span class="mdc-linear-progress__bar-inner"></span>
                    </div>
                    <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                        <span class="mdc-linear-progress__bar-inner"></span>
                    </div>
                </div>
				<section class="mdc-dialog__content form-row-stack">
					<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-theme--error">
							*모든 항목은 필수입력사항입니다.
						</p>
					<!-- 데이터 구분 -->
					<div class="form-row">
						<div class="mdc-select mdc-select--outlined mdc-select--no-label mdc-select--required w-100"
								 id="insert-dataType-mdc-select">
							<div class="mdc-select__anchor" aria-required="true">
								<div class="mdc-notched-outline">
									<span class="mdc-notched-outline__leading"></span>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label mdc-floating-label--required">데이터 구분</label>
									</div>
									<span class="mdc-notched-outline__trailing"></span>
								</div>
								<span class="mdc-select__selected-text-container overflow-hidden">
									<span class="mdc-select__selected-text"></span>
								</span>
								<span class="mdc-select__dropdown-icon"></span>
							</div>
							<div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
								<ul class="mdc-deprecated-list">
									<!--dynamic data-->
								</ul>
							</div>
						</div>
					</div>

					<!-- 서비스 모델 -->
					<div class="form-row">
						<div class="mdc-select mdc-select--outlined mdc-select--no-label mdc-select--required w-100"
							 id="insert-serviceModel-mdc-select">
							<div class="mdc-select__anchor" aria-required="true">
								<div class="mdc-notched-outline">
									<span class="mdc-notched-outline__leading"></span>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label mdc-floating-label--required">서비스 모델</label>
									</div>
									<span class="mdc-notched-outline__trailing"></span>
								</div>
								<span class="mdc-select__selected-text-container overflow-hidden">
									<span class="mdc-select__selected-text"></span>
								</span>
								<span class="mdc-select__dropdown-icon"></span>
							</div>
							<div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
								<ul class="mdc-deprecated-list">
									<!--dynamic data-->
								</ul>
							</div>
						</div>
					</div>

					<!--학습데이터-->
					<div class="form-row multiline-align-top">
						<div class="flex-auto">
							<div class="mdc-text-field text-field mdc-text-field--outlined w-100 lg-size">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text" required
									   id="insert-contents-input"
								/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">LM 학습데이터</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
							<div class="mdc-text-field-helper-line" id="insert-contents-helper-line">
							</div>
						</div>
						<button class="mdc-button mdc-button--outlined mdc-ripple-upgraded lg-size"
								id="insert-contents-dupcheck-btn" disabled>
							<span class="mdc-button__ripple"></span>
							<i class="material-icons mdc-button__icon">group</i>
							<span class="mdc-button__label">중복확인</span>
						</button>
					</div>

					<!--가중치-->
					<div class="form-row multiline-align-top">
						<div class="flex-auto">
							<div class="mdc-text-field text-field mdc-text-field--outlined flex-auto lg-size">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text" required
									   id="insert-repeat-input"
									   value="1"/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">가중치</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
							<div class="mdc-text-field-helper-line" id="insert-repeat-helper-line">
							</div>
						</div>
					</div>

					<!--설명-->
					<div class="form-row multiline-align-top">
						<div class="flex-auto">
							<div class="mdc-text-field text-field mdc-text-field--outlined w-100 lg-size">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text"
									   id="insert-description-input"
								/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">설명</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
							<div class="mdc-text-field-helper-line" id="insert-description-helper-line">
							</div>
						</div>
					</div>
				</section>
				<footer class="mdc-dialog__actions">
					<button id="insert-btn" class="mdc-button mdc-button--unelevated mdc-ripple-upgraded">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">등록</span>
					</button>
					<button
						class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-default mdc-theme--default-bg close-button">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">취소</span>
					</button>
				</footer>
			</div>
		</div>
	</div>
	<!-- <<< 등록 팝업 -->
	
	<!-- >>> 대량 등록 팝업 -->
	<div id="insert-bulk-dialog" class="mdc-dialog mdc-dialog--scrollable" role="alertdialog" aria-modal="true"
		 aria-labelledby="simple-dialog-label" aria-describedby="simple-dialog-description">
		<div class="mdc-dialog__scrim"></div>
		<div class="mdc-dialog__container">
			<div class="mdc-dialog__surface">
				<div class="mdc-dialog__header">
					<h2 class="mdc-dialog__title">LM 학습데이터 대량등록</h2>
					<button class="mdc-button mdc-button--unelevated mdc-ripple-upgraded"
							id="download-bulk-sample-btn">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">양식 다운로드</span>
					</button>
				</div>

				<section class="mdc-dialog__content form-row-stack">
					<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-theme--error">
						*모든 항목은 필수입력사항입니다.<br/>
						<span id="bulk-type-helper-line">최대 500건까지 등록 가능합니다.</span>
					</p>
					<!--  엑셀 파일 등록 -->
					<div class="form-row">
						<!--<h4>파일 업로드</h4>-->
						<!--<div class="sample mdc-layout-grid__cell&#45;&#45;span-12">-->
							<input type="file" id="insert-bulk-excel-file-input" class="d-none" name="file" accept=".xlsx,.XLSX"/>

							<div id="insert-bulk-excel-file-name"
								 class="mdc-text-field text-field mdc-text-field--outlined mdc-text-field--with-leading-icon w-100">
								<i class="mdc-text-field__icon material-icons">attach_file</i>
								<input type="text" class="mdc-text-field__input" aria-describedby="text-field-outlined-shape-one-helper-text" required/>
								<label for="insert-bulk-excel-file-input" class="w-100 h-100 position-absolute" style="z-index: 2; cursor: pointer"></label>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">엑셀 파일</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
							<!--
							<div class="mdc-layout-grid__cell mdc-layout-grid__cell&#45;&#45;span-4">
								<button
									class="mdc-button mdc-button&#45;&#45;outlined mdc-theme&#45;&#45;error mdc-ripple-upgraded w-100"
									id="insert-bulk-excel-file-btn">
									<span class="mdc-button__ripple"></span>
									<i class="material-icons mdc-button__icon me-1">upload</i>
									<span class="mdc-button__label">엑셀 파일 선택 *</span>
								</button>
							</div>
							<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-8 align-middle">
								<span id="insert-bulk-excel-file-name"></span>
							</div>
							-->
						<!--</div>-->
					</div>
					
					<!-- 대량등록 유형 -->
					<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12 " style="display: none">
						<!--<h4>대량등록 유형</h4>-->
						<div class="mdc-form-field">
							<div class="mdc-radio">
								<input class="mdc-radio__native-control" type="radio" id="radio-insert-bulk"
									   name="bulkType" checked
									   value="insert-bulk" readonly>
								<div class="mdc-radio__background">
									<div class="mdc-radio__outer-circle"></div>
									<div class="mdc-radio__inner-circle"></div>
								</div>
								<div class="mdc-radio__ripple"></div>
								<div class="mdc-radio__focus-ring"></div>
							</div>
							<label for="radio-insert-bulk">대량 등록</label>
						</div>
						
						<!--<h5 id="bulk-type-helper-line">최대 500건까지 등록 가능합니다.</h5>-->
					</div>
					
					<!-- progress bar -->
					<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
						<div role="progressbar" class="mdc-linear-progress" aria-label="대량 등록 progress"
							 aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" id="progressbar">
							<div class="mdc-linear-progress__buffer">
								<div class="mdc-linear-progress__buffer-bar"></div>
								<div class="mdc-linear-progress__buffer-dots"></div>
							</div>
							<div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
								<span class="mdc-linear-progress__bar-inner"></span>
							</div>
							<div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
								<span class="mdc-linear-progress__bar-inner"></span>
							</div>
						</div>
					</div>
				</section>
				
				<footer class="mdc-dialog__actions">
					<button id="insert-bulk-btn"
							class="mdc-button mdc-button--unelevated mdc-ripple-upgraded">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">대량 등록</span>
					</button>
					<button
						class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-default mdc-theme--default-bg dialog-close-btn"
						data-mdc-dialog-action="close">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">취소</span>
					</button>
				</footer>
			</div>
		</div>
	</div>
	<!-- <<< 대량 등록 팝업 -->
	
	<!-- >>> 상세 팝업 -->
	<div id="detail-dialog" class="mdc-dialog mdc-dialog--scrollable" role="alertdialog" aria-modal="true"
		 aria-labelledby="simple-dialog-label" aria-describedby="simple-dialog-description">
		<div class="mdc-dialog__scrim"></div>
		<div class="mdc-dialog__container">
			<div class="mdc-dialog__surface">
				<div class="mdc-dialog__header">
					<h2 class="mdc-dialog__title">LM 학습데이터 상세</h2>
					<button class="mdc-icon-button material-icons close-button" data-mdc-dialog-action="close" tabindex="-1">
						close
					</button>
				</div>
				
				<section class="mdc-dialog__content form-row-stack">
					<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-theme--error">
							*모든 항목은 필수입력사항입니다.
						</p>

					<!-- 데이터 구분 select -->
					<div class="form-row">
						<div class="mdc-select mdc-select--outlined mdc-select--no-label mdc-select--required w-100"
							 id="detail-dataType-mdc-select">
							<div class="mdc-select__anchor" aria-required="true">
								<div class="mdc-notched-outline">
									<span class="mdc-notched-outline__leading"></span>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label mdc-floating-label--required">데이터 구분</label>
									</div>
									<span class="mdc-notched-outline__trailing"></span>
								</div>
								<span class="mdc-select__selected-text-container overflow-hidden">
                                        <span class="mdc-select__selected-text"></span>
                                    </span>
								<span class="mdc-select__dropdown-icon"></span>
							</div>
							<div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
								<ul class="mdc-deprecated-list">
									<!--dynamic data-->
								</ul>
							</div>
						</div>
					</div>
					
					<!-- 서비스 모델 select -->
					<div class="form-row">
						<div class="mdc-select mdc-select--outlined mdc-select--no-label mdc-select--required w-100"
							 id="detail-serviceModel-mdc-select">
							<div class="mdc-select__anchor" aria-required="true">
								<div class="mdc-notched-outline">
									<span class="mdc-notched-outline__leading"></span>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label mdc-floating-label--required">서비스 모델</label>
									</div>
									<span class="mdc-notched-outline__trailing"></span>
								</div>
								<span class="mdc-select__selected-text-container overflow-hidden">
                                    <span class="mdc-select__selected-text"></span>
                                </span>
								<span class="mdc-select__dropdown-icon"></span>
							</div>
							<div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
								<ul class="mdc-deprecated-list">
									<!--dynamic data-->
								</ul>
							</div>
						</div>
					</div>
					
					<!-- LM 학습데이터 -->
					<div class="form-row multiline-align-top">
						<div class="flex-auto">
							<div class="mdc-text-field text-field mdc-text-field--outlined w-100 lg-size">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text" required
									   id="detail-contents-input"
								/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">LM 학습데이터</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
							<div class="mdc-text-field-helper-line" id="detail-contents-helper-line">
							</div>
						</div>
						<button class="mdc-button mdc-button--outlined mdc-ripple-upgraded lg-size"
										id="detail-contents-dupcheck-btn" disabled>
									<span class="mdc-button__ripple"></span>
									<i class="material-icons mdc-button__icon">group</i>
									<span class="mdc-button__label">중복확인</span>
								</button>
					</div>
					
					<!-- 가중치 -->
					<div class="form-row multiline-align-top">
						<div class="flex-auto">
							<div class="mdc-text-field text-field mdc-text-field--outlined w-100 lg-size">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text" required
									   id="detail-repeat-input"
								/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">가중치</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
							<div class="mdc-text-field-helper-line" id="detail-repeat-helper-line">
							</div>
						</div>
					</div>
					
					<!-- 설명 -->
					<div class="form-row multiline-align-top">
						<div class="flex-auto">
							<div class="mdc-text-field text-field mdc-text-field--outlined w-100 lg-size">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text"
									   id="detail-description-input"
								/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">설명</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
							<div class="mdc-text-field-helper-line" id="detail-description-helper-line">
							</div>
						</div>
					</div>
					
					<!-- 기본 정보 -->
					<h4>기본 정보</h4>
					<div class="form-row">
						<div class="mdc-layout-grid__cell--span-6 mdc-form-field">
							<div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text" readonly
									   id="detail-reg-date"
									   value=""/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">등록일</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
						</div>
						<div class="mdc-layout-grid__cell--span-6 mdc-form-field">
							<div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
								<input type="text" class="mdc-text-field__input"
									   aria-describedby="text-field-outlined-shape-one-helper-text" readonly
									   id="detail-upd-regId"
									   value=""/>
								<div class="mdc-notched-outline mdc-notched-outline--upgraded">
									<div class="mdc-notched-outline__leading"></div>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label">등록자</label>
									</div>
									<div class="mdc-notched-outline__trailing"></div>
								</div>
							</div>
						</div>
					</div>
				</section>
				<footer class="mdc-dialog__actions">
					<button
						class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-error mdc-theme--error-bg"
						id="delete-btn">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">삭제</span>
					</button>
					<button
						class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-default mdc-theme--default-bg dialog-close-btn"
						data-mdc-dialog-action="close">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">취소</span>
					</button>
					<button id="update-btn" class="mdc-button mdc-button--unelevated mdc-ripple-upgraded">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">수정</span>
					</button>
				</footer>
			</div>
		</div>
	</div>
	<!-- <<< 상세 팝업 -->
	
	<!-- >>> 삭제 팝업 -->
	<div id="delete-dialog" class="mdc-dialog mdc-dialog--scrollable" role="alertdialog" aria-modal="true"
		 aria-labelledby="simple-dialog-label" aria-describedby="simple-dialog-description">
		<div class="mdc-dialog__scrim"></div>
		<div class="mdc-dialog__container">
			<div class="mdc-dialog__surface">
				<div class="mdc-dialog__header">
					<h2 class="mdc-dialog__title">LM 학습데이터 일괄 삭제</h2>
					<button class="mdc-icon-button material-icons close-button" data-mdc-dialog-action="close" tabindex="-1">
						close
					</button>
				</div>
				
				<section class="mdc-dialog__content form-row-stack">
					<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-theme--error">
							*모든 항목은 필수입력사항입니다.
						</p>

					<!-- 서비스 모델 select -->
					<div class="form-row">
						<div class="mdc-select mdc-select--outlined mdc-select--no-label mdc-select--required w-100"
							 id="delete-serviceModel-mdc-select">
							<div class="mdc-select__anchor" aria-required="true">
								<div class="mdc-notched-outline">
									<span class="mdc-notched-outline__leading"></span>
									<div class="mdc-notched-outline__notch">
										<label class="mdc-floating-label mdc-floating-label--required">서비스 모델</label>
									</div>
									<span class="mdc-notched-outline__trailing"></span>
								</div>
								<span class="mdc-select__selected-text-container overflow-hidden">
                                        <span class="mdc-select__selected-text"></span>
                                    </span>
								<span class="mdc-select__dropdown-icon"></span>
							</div>
							<div class="mdc-layout-grid__inner mdc-menu-surface--fixed" style="z-index: 9999;">
								<div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth"
									 id="selectWrapper">
									<ul class="mdc-deprecated-list">
										<!--dynamic data-->
									</ul>
								</div>
							</div>
						</div>
					</div>
				</section>
				<footer class="mdc-dialog__actions">
					<button
						class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-default mdc-theme--default-bg dialog-close-btn"
						data-mdc-dialog-action="close">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">취소</span>
					</button>
					<button id="deleteAll-btn" class="mdc-button mdc-button--unelevated mdc-ripple-upgraded">
						<span class="mdc-button__ripple"></span>
						<span class="mdc-button__label">일괄 삭제</span>
					</button>
				</footer>
			</div>
		</div>
	</div>
	<!-- <<< 삭제 팝업 -->
	<input type="hidden" readonly id="smpServiceUriPrefix" th:value="${smpServiceUriPrefix}">
	<input type="hidden" readonly id="defaultPageSize" th:value="${defaultPageSize}">
</th:block>

<th:block layout:fragment="script">
	<script type="text/javascript">
        (function () {
			var LABEL = {
				searchCondition: {
								pageSize: $("#defaultPageSize").val(),
								trainDataId: 0,
								dataType: "",
								serviceModelId: "",
								contents: "",
								uploadedBy: "",
								description: "",
								from: "",
								to: ""
						},
			}
			
			
            var siteCode = "[[${siteCode}]]";
            var projectCode = "[[${projectCode}]]";

            new Vue({
                el: ".contentRoot",
                data: {
                    // 팝업
                    insertDialog: mdc.dialog.MDCDialog.attachTo(document.querySelector('#insert-dialog')),
                    insertBulkDialog: mdc.dialog.MDCDialog.attachTo(document.querySelector('#insert-bulk-dialog')),
                    detailDialog: mdc.dialog.MDCDialog.attachTo(document.querySelector('#detail-dialog')),
                    deleteDialog: mdc.dialog.MDCDialog.attachTo(document.querySelector('#delete-dialog')),
                    
                    insertDialogLoadingBar: $("#insert-dialog-loadingbar"),
                    // 검색
                    searchCondition: {...LABEL.searchCondition},
                    searching: false,
                    searchResults: [],

                    // pagination
                    pageSizes: [10, 20, 30, 40, 50],
                    currentPage: 1,
                    pageInfo: {
                        pages: 1,
                        total: 1
                    },
                    pageNumLists: [1],

                    // 검색 조건
                    dataTypes: [],
                    serviceModels: [],

                    // 등록, 상세 obj
                    newObj: JSON.parse(JSON.stringify(
                        {
                            "trainDataId": 0,
                            "dataType": "",
                            "serviceModelId": "",
                            "contents": "",
                            "repeatCount": "",
                            "description": "",
                            "contentsDupCheck": true
                        }
                    )),
                    detailObj: JSON.parse(JSON.stringify(
                        {
                            "trainDataId": 0,
                            "serviceModelId": "",
                            "contents": "",
                            "repeatCount": "",
                            "description": "",
                            "contentsDupCheck": true,
                            "regDt": "",
                            "regId": "",
                        }
                    )),
                    prevDetailObj: JSON.parse(JSON.stringify(
                        {
                            "trainDataId": 0,
                            "serviceModelId": "",
                            "contents": "",
                            "repeatCount": "",
                            "description": "",
                            "contentsDupCheck": true,
                            "regDt": "",
                            "regId": "",
                        }
                    )),
                    deleteObj: JSON.parse(JSON.stringify({"serviceModelId": ""})),
                    prevContent: "",
                    prevRepeat: "",
                    prevDescription: "",

                    // constant
                    CONTENTS_MAX_LENGTH: 255,
                    REPEAT_COUNT_MAX_VAL: 10000,
                    DESCRIPTION_MAX_LENGTH: 255,

					// etc
					currentXhr: [],			// 모달 내 XHR 중단할 때 사용
					checkXhrAbort: false,	// 모달 내에서 등록/저장 등 업로드 시엔 컨펌 추가
					currentDialog: null     // vue data에서 정의한 모달의 key. ( :string)
                },
                computed: {
                    pages: function () {
                        const list = [];
                        for (let index = this.startPage; index <= this.endPage; index += 1) {
                            list.push(index);
                        }
                        return list;
                    },
                    startPage() {
                        return parseInt((this.currentPage - 1) / 5) * 5 + 1;
                    },
                    endPage() {
                        var lastPage = parseInt((this.currentPage - 1) / 5 + 1) * 5;
                        return lastPage <= this.pageInfo.pages ? lastPage : this.pageInfo.pages;
                    }
                },
                created: function () {
					console.log("trainData page created");
                    // Base url 받아오기
                    const baseUrl = document.querySelector('#smpServiceUriPrefix').value;
                    this.baseUrl = baseUrl;

                    // 데이터 구분 목록 받아오기
                    var self = this;
                    this.initDataTypes(() => {

                        // 검색바 데이터 구분 mdc-select 초기화
                        self.$nextTick(function () {
                            const $select = $("#dataTypes-mdc-select")[0];
                            $($select).data('instance').destroy();

                            const newMdcSelect = new mdc.select.MDCSelect($select);
                            $($select).data('instance', newMdcSelect);
                        })

                        // /*// insert, detail select에 서비스 추가
                        var ulHtmlStr = '';
                        for (var i = 0; i < this.dataTypes.length; i++) {
                            var dataType = this.dataTypes[i];
                            var htmlStr = `
						    <li class="mdc-deprecated-list-item ${i == 0 ? 'mdc-deprecated-list-item--selected' : ''}"
						        ${i == 0 ? 'aria-selected ' : ''}
						        data-value="${dataType.key}">
						        <span class="mdc-deprecated-list-item__ripple"></span>
						        <span class="mdc-deprecated-list-item__text">${i == 0 ? '선택' : dataType.value}</span>
						    </li>`
                            ulHtmlStr += htmlStr;
                        }

                        $("#insert-dataType-mdc-select ul").html(ulHtmlStr)
                        $("#detail-dataType-mdc-select ul").html(ulHtmlStr)
                    })
                    this.initServiceModels(() => {

                        // 검색바 서비스모델 mdc-select 초기화
                        self.$nextTick(function () {
                            const $select = $("#serviceModels-mdc-select")[0];
                            $($select).data('instance').destroy();

                            const newMdcSelect = new mdc.select.MDCSelect($select);
                            $($select).data('instance', newMdcSelect);
                        })

                        // insert, detail select에 서비스 추가
                        var ulHtmlStr = '';
                        for (var i = 0; i < this.serviceModels.length; i++) {
                            var serviceModel = this.serviceModels[i];
                            var htmlStr = `
                            <li class="mdc-deprecated-list-item ${i == 0 ? 'mdc-deprecated-list-item--selected' : ''}"
                                ${i == 0 ? 'aria-selected ' : ''}
                                data-value="${serviceModel.key}">
                                <span class="mdc-deprecated-list-item__ripple"></span>
                                <span class="mdc-deprecated-list-item__text">${i == 0 ? '선택' : serviceModel.value}</span>
                            </li>`
                            ulHtmlStr += htmlStr;
                        }

                        $("#insert-serviceModel-mdc-select ul").html(ulHtmlStr)
                        $("#detail-serviceModel-mdc-select ul").html(ulHtmlStr)
                        $("#delete-serviceModel-mdc-select ul").html(ulHtmlStr)

                        const $insertServiceSelect = $("#insert-serviceModel-mdc-select")[0];
                        $($insertServiceSelect).data('instance').destroy();
                        const newInsertMdcSelect = new mdc.select.MDCSelect($insertServiceSelect);
                        $($insertServiceSelect).data('instance', newInsertMdcSelect);

                        const $detailServiceSelect = $("#detail-serviceModel-mdc-select")[0];
                        $($detailServiceSelect).data('instance').destroy();
                        const newUpdateMdcSelect = new mdc.select.MDCSelect($detailServiceSelect);
                        $($detailServiceSelect).data('instance', newUpdateMdcSelect);

                        const $deleteServiceSelect = $("#delete-serviceModel-mdc-select")[0];
                        $($deleteServiceSelect).data('instance').destroy();
                        const newDeleteMdcSelect = new mdc.select.MDCSelect($deleteServiceSelect);
                        $($deleteServiceSelect).data('instance', newDeleteMdcSelect);
                    })
                    this.search();
                },
                mounted: function () {

                    // 페이지 이동시 처리
                    $('#drawer-main-content-viewer').one('page.move', function () {
                        console.log("page move out");
												var $fromAtInput = $('#from-date-mdc');
												var $toAtInput = $('#to-date-mdc');
												$fromAtInput.data('datepicker').destroy();
												$toAtInput.data('datepicker').destroy();
                    });
                    this.initMaterialUx();
                    this.initSearchBarEvents();

                    var self = this;

                    // >>> 등록 dialog 설정
                    var insertDialog = this.insertDialog;

                    /*$('#insert-dialog-btn').off('click').on('click', function () {
                        insertDialog.open();
                    });*/

                    insertDialog.listen('MDCDialog:opening', function () {

                        // 화면 및 데이터 초기화
                        self.initializeInsertDialog();

                        // component 이벤트 등록
                        $("#insert-dataType-mdc-select").off('MDCSelect:change').on('MDCSelect:change', self.onChangeInsertDataType)
                        $("#insert-serviceModel-mdc-select").off('MDCSelect:change').on('MDCSelect:change', self.onChangeInsertServiceModel)
                        $("#insert-contents-input").off('keyup').on('keyup', self.onChangeInsertContents)
                        $("#insert-contents-dupcheck-btn").off('click').on('click', self.onClickInsertContentsDupCheck)
                        $("#insert-repeat-input").off('keyup').on('keyup', self.onChangeInsertRepeat)
                        $("#insert-description-input").off('keyup').on('keyup', self.onChangeInsertDescription)

                        $("#insert-btn").off('click').on('click', self.insert)
                    });

                    $('#insert-dialog-btn').off('click').on('click', function () {
                        self.insertDialog.open();
												self.currentDialog = 'insertDialog';
                    });
                    // <<< 등록 dialog 설정

                    // >>> 대량등록 dialog 설정
                    var insertBulkDialog = this.insertBulkDialog;

                    $("#insert-bulk-dialog-btn").off('click').on('click', function () {
                        insertBulkDialog.open();
                    });
                    insertBulkDialog.listen('MDCDialog:opening', function () {
                        // 화면 및 데이터 초기화
                        self.initializeInsertBulkDialog();

                        // 이벤트 추가
                        $("#insert-bulk-excel-file-btn").off('click').on('click', self.onClickInsertBulkExcelFileBtn);
                        $("#insert-bulk-excel-file-input").off('change').on('change', self.onChangeInsertBulkExcelFile);

                        $("#download-bulk-sample-btn").off('click').on('click', self.downloadBulkSampleExcel);
                        $("#insert-bulk-btn").off('click').on('click', () => self.insertBulk(false));
                    });
                    // >>> 대량등록 dialog 설정

                    // >>> 상세 dialog 설정
                    var detailDialog = this.detailDialog;
                    detailDialog.listen('MDCDialog:opening', function () {
                        // 화면 및 데이터 초기화
                        self.initializeUpdateDialog();

                        // 이벤트 등록
                        $("#detail-dataType-mdc-select").off('MDCSelect:change').on('MDCSelect:change', self.onChangeUpdateDataType)
                        $("#detail-serviceModel-mdc-select").off('MDCSelect:change').on('MDCSelect:change', self.onChangeUpdateServiceModel)
                        $("#detail-contents-input").off('keyup').on('keyup', self.onChangeUpdateContents)
                        $("#detail-contents-dupcheck-btn").off('click').on('click', self.onClickUpdateContentsDupCheck)
                        $("#detail-repeat-input").off('keyup').on('keyup', self.onChangeUpdateRepeat)
                        $("#detail-description-input").off('keyup').on('keyup', self.onChangeUpdateDescription)

                        $("#update-btn").off('click').on('click', self.update)
                        $("#delete-btn").off('click').on('click', self.delete)

                    });
                    // <<< 상세 dialog 설정

                    // >>> 삭제 dialog 설정
                    var deleteDialog = this.deleteDialog;

                    $('#delete-dialog-btn').off('click').on('click', function () {
                        deleteDialog.open();
                    });

                    deleteDialog.listen('MDCDialog:opening', function () {
                        // 화면 및 데이터 초기화
                        self.initializeDeleteDialog();

                        // 이벤트 등록
                        $("#delete-serviceModel-mdc-select").off('MDCSelect:change').on('MDCSelect:change', self.onChangeDeleteServiceModel)

                        $("#deleteAll-btn").off('click').on('click', self.deleteAll)
                    });
                    // <<< 삭제 dialog 설정

					// 모달 닫기 및 xhr 종료 이벤트 바인딩
					$('.close-button').off('click').on('click', function () {
						self.onCloseDialog();
					})
					$('.mdc-dialog').on('keydown', function (e) {
						if (e.key === 'Escape') self.onCloseDialog();
					})
                },
                methods: {
                    initMaterialUx: function () {
						// ripple material ux 적용
						const elements = document.querySelectorAll('.mdc-ripple-upgraded');
						for (const el of elements) {
							if($(el).data('ripple') != null) {
								$(el).data('ripple').destroy();
							}
							$(el).data('ripple', mdc.ripple.MDCRipple.attachTo(el, el.classList.contains('mdc-ripple-upgraded--unbounded') ? {
								isUnbounded: true
							} : void 0));
						}

						// input text material ux 적용
						const textFields = document.querySelectorAll('.mdc-text-field');
						for (const el of textFields) {
							if($(el).data('instance') != null) {
								$(el).data('instance').destroy();
							}
							$(el).data('instance', mdc.textField.MDCTextField.attachTo(el));
						}

						// select material ux 적용
						/*const selects = document.querySelectorAll('.mdc-select');
						for (const el of selects) {
							if($(el).data('instance') != null) {
								$(el).unbind('MDCSelect:change');
								$(el).data('instance').destroy();
							}

							var $select = mdc.select.MDCSelect.attachTo(el);
							var $el = $(el);
							var value = $el.attr('data-value');
							// 초기값 설정
							_.isEmpty(value) ? $select.setSelectedIndex(0) : $select.setValue(value);
							$el.data('instance', $select);
						}*/
						const selects = document.querySelectorAll('.mdc-select');
                        for (const el of selects) {
                            const select = mdc.select.MDCSelect.attachTo(el);
                            $(el).data('instance', select); //
                        }

                        // linear progress material ux 적용
                        const progresses = document.querySelectorAll('.mdc-linear-progress');
                        for (const el of progresses) {
                            const progress = mdc.linearProgress.MDCLinearProgress.attachTo(el);
                            $(el).data('instance', progress); //
                        }

                        // datepicker material ux 적용
                        this.initMaterialDatepickers();

                        // dialog에 close 이벤트 주는 방법: escape key, dialog 외부 클릭 막기.
                        this.insertDialog.scrimClickAction = "";
                        this.insertBulkDialog.scrimClickAction = "";
                        this.detailDialog.scrimClickAction = "";
                        this.deleteDialog.scrimClickAction = "";
                    },

                    initMaterialDatepickers: function () {

                        // datepicker 적용
                        var self = this;
                        var $fromAtInput = $('#from-date-mdc');
                        var $toAtInput = $('#to-date-mdc');


                        // https://github.com/FreddyFY/material-datepicker
                        var datepickerOption = {
                            lang: "en",
                            orientation: "portrait",
                            color: document.defaultView.getComputedStyle(document.documentElement).getPropertyValue("--mdc-theme-primary"),
                            closeAfterClick: false,
                            outputFormat: 'YYYY-MM-DD',
                            topHeaderFormat: 'YYYY MM',
                            headerFormat: 'Do' // 1st 2nd ... 30th 31st
                        };

                        if ($fromAtInput.data('datepicker') != null) {
                            $fromAtInput.data('datepicker').destroy();
                        }

                        $fromAtInput.data('datepicker', new MaterialDatepicker($fromAtInput.data('instance').input, $.extend({}, datepickerOption, {
                            onChange: function (date) {
                                if (_.isEmpty($fromAtInput.data('instance').value)) {
                                    self.searchCondition.from = "";
                                } else {
                                    self.searchCondition.from = moment(date).format("YYYY-MM-DD");
                                }
                            }
                        })));

                        if ($toAtInput.data('datepicker') != null) {
                            $toAtInput.data('datepicker').destroy();
                        }

                        $toAtInput.data('datepicker', new MaterialDatepicker($toAtInput.data('instance').input, $.extend({}, datepickerOption, {
                            onChange: function (date) {
                                if (_.isEmpty($toAtInput.data('instance').value)) {
                                    self.searchCondition.to = "";
                                } else {
                                    self.searchCondition.to = moment(date).format("YYYY-MM-DD");
                                }
                            }
                        })));
                        $fromAtInput.data('instance').value = '';
                        $toAtInput.data('instance').value = '';
                    },

                    // 팝업 데이터 초기화
                    initDataTypes: function (callback) {
                        this.dataTypes = [
                            {key: 0, value: "전체"},
                            {key: "COMMON", value: "일반"},
                            {key: "DICTATION", value: "전사"},
                            {key: "EXTERNAL", value: "외부"}
                        ];
                        callback();
                    },
                    initServiceModels: function (callback) {

                        $.ajax({
                            url: this.baseUrl + "/trainData/api/serviceModelList",
                            method: "get",
                            contentType: 'application/json; charset=UTF-8',
                            dataType: "json"
                        }).done(data => {
                            var resultList = [];
                            if (data && data.result && data.result.length > 0) {
                                var result = data.result;
                                result.forEach(r => {
                                    resultList.push(
                                        {key: r.serviceCode, value: r.serviceModelName}
                                    );
                                })
                            }
                            this.serviceModels = [{key: 0, value: "전체"}];
                            this.serviceModels.push(...resultList);
                            callback();
                        });
                    },

                    // 검색
                    search: function (isSearchButtonClicked) {
                        this._setSearching(true);

                        this.searchCondition.contents = this.searchCondition.contents.trim();
                        this.searchCondition.uploadedBy = this.searchCondition.uploadedBy.trim();
												this.searchCondition.description = this.searchCondition.description.trim();

                        var searchConditions = {...this.searchCondition}
                        
                        if (isSearchButtonClicked) {
							searchConditions['pageNum'] = 1;
						} else {
							searchConditions['pageNum'] = this.currentPage;
						}

                        commonObject.deleteNullOrDefaultFields(searchConditions);
                        var queryString = Qs.stringify(searchConditions);

                        $.ajax({
                            url: this.baseUrl + "/trainData/api/listPage?" + queryString,
                            method: "get",
                            contentType: 'application/json; charset=UTF-8',
                            dataType: "json"
                        }).done(data => {
                            this._setSearchResultsPageInfo(data); // 검색 결과 페이지 정보 저장
                            this._setSearchResults(data.result); // 검색 결과 목록
                        }).always(() => {
                            this._setSearching(false);
                            this.initCheckBox();
                        })
                    },

                    // 상세
                    detail: function (trainDataId, callback) {
                        $.ajax({
                            url: this.baseUrl + "/trainData/api/detail/" + trainDataId,
                            method: "get",
                            contentType: 'application/json; charset=UTF-8',
                            dataType: "json",
                        }).done(result => {
							console.log(">>>>> result : " , result);
                            this.detailObj = {...result.result};

                            this.detailObj.contentsDupCheck = true;

                            this.prevDetailObj = {...result.result};
                            this.prevContent = result.result.contents;
                            this.prevRepeat = result.result.repeatCount;
                            this.prevDescription = result.result.description;

                            callback();
                        });
                    },
					setDisplayNone: function(jqueryElement, option) {
						if (option == true) {
							jqueryElement.css("opacity", 0);
							return;
						}
						jqueryElement.css("opacity", 1);
					},
                    // 등록
                    insert: function (e) {
                        if (!this.validateInsert()) {
                            return;
                        }
                        var newObj = {...this.newObj}
                        delete newObj['contentsDupCheck']

						let apiUrl = this.baseUrl + "/trainData/api/insert";

                        if (confirm("등록하시겠습니까?")) {
							this.setDisplayNone(this.insertDialogLoadingBar, false);
							this.checkXhrAbort = true;
							this.dispatchProcessing('process');
							var self = this;
                            let xhr = $.ajax({
                                url: apiUrl,
                                method: "post",
                                contentType: 'application/json; charset=UTF-8',
                                dataType: "json",
                                data: JSON.stringify(newObj)
                            }).done(result => {
                                if (result.resultCode == "0000") {
                                    toastr.success(result.resultMsg);
                                    self.insertDialog.close();
                                } else {
									toastr.error(result.resultMsg);
								}
                            }).always(() => {
                                this.search();
                                this.setDisplayNone(this.insertDialogLoadingBar, true);
								// 배열에서 해당 xhr 제거 및 checkXhrAbort 초기화
								let result = self.currentXhr.find(obj => obj.id === apiUrl);
								if (result) {
									let index = self.currentXhr.indexOf(result);
									self.currentXhr.splice(index, 1);
								}
								self.checkXhrAbort = false;
								self.dispatchProcessing('done');
                            });
							// abort 적용을 위해 xhr 객체에 id를 추가해 배열에 push
							let result = {id: apiUrl, xhr};
							self.currentXhr.push(result);
                        }

                        e.preventDefault();
                        e.stopPropagation();
                    },

                    // 대량 등록
                    insertBulk: function (doDeploy) {

                        if (!confirm("대량 등록 하시겠습니까?")) {
                            return;
                        }

                        if (!this.validateInsertBulk()) {
                            return;
                        }

                        var formData = new FormData();

                        // 요청값 생성
                        formData.append("excelFile", $("#insert-bulk-excel-file-input").prop("files")[0]);

                        var self = this;
                        $.ajax({
                            url: this.baseUrl + "/trainData/api/insertBulk",
                            method: "post",
                            processData: false,
                            contentType: false,
                            cache: false,
                            enctype: 'multipart/form-data',
                            dataType: "json",
                            data: formData,
                            success: function (result) {
                                toastr.success(result.resultMsg);

                                if (result.resultCode == "0000") {
                                    SessionUtils.setBulkKey(result.result.key);
                                    self.getBulkProgress();

                                    // dialog close는 getBulkProgress에서.
                                }
                            },
                            error: function (xhr, status, error) {
                                self._closeProgress();
                                toastr.error(xhr.status + " : 서버 처리 중 오류가 발생했습니다.");
                            }
                        });
                    },

                    getBulkProgress: function () {
                        var self = this;

                        $.ajax({
                            url: this.baseUrl + "/trainData/api/insertBulk/" + SessionUtils.getBulkKey() + "/progress",
                            method: "get",
                            dataType: "json"
                        }).done(result => {

                            var message = result.resultMsg + "\n";
                            message += `총 요청 ${result.result.totalCount} 건, 성공 ${result.result.successCount} 건, 실패 ${result.result.totalCount - result.result.successCount} 건 입니다.`

                            if (result.resultCode != "0000" && result.resultCode != "0002") {
                                toastr.error(message);
                                this.insertBulkDialog.close();
                                return;
                            }

                            if (result.resultCode == "0000") {
                                toastr.success(message);
                                SessionUtils.clearBulkKey();
                                this._closeProgress();
                                this.insertBulkDialog.close();
                                this.search();
                                return;
                            }

                            setTimeout(function () {
                                if (result.resultCode == "0002") {
                                    self._updateProgress(result.result.currCount, result.result.totalCount);
                                    self.getBulkProgress();
                                }
                            }, 1000)

                        });
                    },
                    _updateProgress: function (currCount, totalCount) {
                        var progressMdc = $("#progressbar").data('instance');
                        if (progressMdc.foundation.isClosed()) {
                            progressMdc.open();
                        }
                        var percentage = (currCount / totalCount);
                        progressMdc.progress = percentage;
                    },
                    _closeProgress: function () {
                        var progressMdc = $("#progressbar").data('instance');
                        progressMdc.close();
                    },

                    // 수정
                    update: function (e) {

                        if (!this.validateUpdate()) {
                            return;
                        }

                        var updateObj = {...this.detailObj}

                        delete updateObj['contentsDupCheck']

                        if (confirm("수정하시겠습니까?")) {
                            $.ajax({
                                url: this.baseUrl + "/trainData/api/update",
                                method: "post",
                                data: JSON.stringify(updateObj),
                                contentType: 'application/json; charset=UTF-8',
                                dataType: "json"

                            }).done(result => {
                                toastr.success(result.resultMsg);
                                if (result.resultCode == "0000") {
                                    this.detailDialog.close();
                                }
                            }).always(() => {
                                this.search();
                            });
                        }
                    },

                    // 삭제
                    delete: function () {

                        var trainDataId = this.detailObj.id;
                        var trainDataIdList = [trainDataId];
                        var postBody = {
                            trainDataIdList: trainDataIdList
                        };

                        if (confirm("삭제하시겠습니까?")) {
                            $.ajax({
                                url: this.baseUrl + "/trainData/api/delete",
                                method: "post",
                                contentType: 'application/json; charset=UTF-8',
                                dataType: "json",
                                data: JSON.stringify(postBody)
                            }).done(result => {
                                toastr.success(result.resultMsg)
                                this.detailDialog.close();
                            }).always(() => {
                                this.search();
                            });
                        }
                    },

                    // 선택 삭제
                    deleteSelected: function () {

                        var trainDataIdList = $.map($('.deleteChk:checkbox:checked'), function (chk) {
                            return $(chk).val();
                        });

                        if (trainDataIdList && trainDataIdList.length == 0) {
                            toastr.error("삭제 할 항목을 선택해주세요.");
                            return;
                        }

                        var postBody = {
                            trainDataIdList: trainDataIdList
                        };

                        if (confirm("선택한 항목을 삭제하시겠습니까?")) {
                            $.ajax({
                                url: this.baseUrl + "/trainData/api/delete",
                                method: "post",
                                contentType: 'application/json; charset=UTF-8',
                                dataType: "json",
                                data: JSON.stringify(postBody)
                            }).done(result => {
                                toastr.success(result.resultMsg)
                                this.search();

                                this.initCheckBox();
                            });
                        }
                    },

                    // 일괄 삭제
                    deleteAll: function () {

                        if (!this.validateDelete()) {
                            return;
                        }

                        var data = {
                            serviceModelId: this.deleteObj.serviceModelId
                        }

                        if (confirm("선택한 서비스 모델의 학습 데이터를 모두 삭제하시겠습니까?")) {
                            $.ajax({
                                url: this.baseUrl + "/trainData/api/deleteAll",
                                method: "post",
                                contentType: 'application/json; charset=UTF-8',
                                dataType: "json",
                                data: JSON.stringify(data)
                            }).done(result => {
                                toastr.success(result.resultMsg)
                                this.deleteDialog.close();

                                this.initCheckBox();

                            }).always(() => {
                                this.search();
                            });
                        }
                    },

                    // 엑셀 다운로드
                    downloadListExcel: function (e) {
                        if (confirm("LM 학습데이터 검색 결과 엑셀 파일을 다운로드하시겠습니까?")) {
                            var searchConditions = {...this.searchCondition}

                            commonObject.deleteNullOrDefaultFields(searchConditions);
                            var queryString = Qs.stringify(searchConditions);

                            var downloadUrl = this.baseUrl + "/file/excel/trainData?" + queryString
                                + "&x-smp-site-code=" + siteCode + "&x-smp-project-code=" + projectCode;
                            window.open(downloadUrl, "_self", 'width=200, height=200, left=2000, top=2000');
                        }
                    },

                    downloadBulkSampleExcel: function (e) {
                        if (confirm("대량등록 엑셀 양식을 다운로드하시겠습니까?")) {
                            var downloadUrl = this.baseUrl + "/file/excel/trainData/sample?x-smp-site-code=" + siteCode + "&x-smp-project-code=" + projectCode;
                            window.open(downloadUrl, "_self", 'width=500, height=200, left=2000, top=2000');
                        }
                    },

                    // 등록 팝업 초기화
                    initializeInsertDialog: function () {

                        var $insertDataTypeElement = $("#insert-dataType-mdc-select")[0];
                        $($insertDataTypeElement).data('instance').setSelectedIndex(0);

                        var $insertServiceModelElement = $("#insert-serviceModel-mdc-select")[0];
                        $($insertServiceModelElement).data('instance').setSelectedIndex(0);

                        // 학습데이터
                        $($('#insert-contents-input')[0].parentElement).data('instance').value = '';
                        this._showValidationHelperLine('', $("#insert-contents-helper-line"), '학습데이터');
                        this._disableInsertContentsDuplCheckBtn(true);

                        // 가중치
                        $($('#insert-repeat-input')[0].parentElement).data('instance').value = '';
                        this._showValidationHelperLine('', $("#insert-repeat-helper-line"), '서버 가중치');

                        // 설명
                        $($('#insert-description-input')[0].parentElement).data('instance').value = '';
                        this._showValidationHelperLine('', $("#insert-description-helper-line"), '설명');
                    },

                    initializeInsertBulkDialog: function () {

                        // 엑셀 파일
                        $("#insert-bulk-excel-file-input")[0].value = null;
                        $("#insert-bulk-excel-file-name").data('instance').value="";

                        this._showBulkButtons();
                    },

                    // 상세 팝업 초기화
                    initializeUpdateDialog: function () {

                        // 데이터 구분
                        var $detailDataTypeSelect = $("#detail-dataType-mdc-select")[0];
                        $($detailDataTypeSelect).data('instance').value = this.detailObj.dataType;

                        // 서비스 모델
                        var $detailServiceModelSelect = $("#detail-serviceModel-mdc-select")[0];
                        $($detailServiceModelSelect).data('instance').value = String(this.detailObj.serviceModelId);

                        // LM 학습데이터
                        $($('#detail-contents-input')[0].parentElement).data('instance').value = this.detailObj.contents;
                        this._showValidationHelperLine('', $("#detail-contents-helper-line"), 'LM 학습데이터');
                        this._disableUpdateContentsDuplCheckBtn(true);

                        // 가중치
                        $($('#detail-repeat-input')[0].parentElement).data('instance').value = this.detailObj.repeatCount;
                        this._showValidationHelperLine('', $("#detail-repeat-helper-line"), '가중치');

                        // 설명
                        if (this.detailObj.description != null && this.detailObj.description != undefined && this.detailObj.description != '') {
                            $($('#detail-description-input')[0].parentElement).data('instance').value = this.detailObj.description;
                            this._showValidationHelperLine('', $("#detail-description-helper-line"), '설명');
                        } else {
                            $($('#detail-description-input')[0].parentElement).data('instance').value = '';
                            this._showValidationHelperLine('', $("#detail-description-helper-line"), '설명');
                        }

                        // 등록일
                        $($('#detail-reg-date')[0].parentElement).data('instance').value = this.detailObj.regDt

                        // 수정일
                        $($('#detail-upd-regId')[0].parentElement).data('instance').value = this.detailObj.regId

                    },

                    // 상세 팝업 초기화
                    initializeDeleteDialog: function () {

                        // 서비스 모델
                        var $deleteServiceModelSelect = $("#delete-serviceModel-mdc-select")[0];
                        $($deleteServiceModelSelect).data('instance').setSelectedIndex(0);
                        
                        $("#selectWrapper").css('max-height', '');
                        $("#selectWrapper").css('max-height', '200px');
                    },

                    // 검색 이벤트
                    initSearchBarEvents: function () {
                        var self = this;
                        $('.search-bar input').on("keydown", function (e) {
                            if (e.keyCode == 13) {
                                self.search(true);
                            }
                        });
                    },

                    _setSearchResults: function (result) {
                        this.searchResults = result;
                    },
                    _setSearchResultsPageInfo: function (data) {
                        this.pageInfo.pages = data.pages;
                        this.pageInfo.total = data.total;
                        this.currentPage = data.pageNum;
                    },
                    _setSearching: function (searching) {
                        this.searching = searching;
                    },

                    // 페이지네이션
                    gotoPage: function (pageNum) {
                        let validPageNum = pageNum;
                        if (pageNum < 1) {
                            validPageNum = 1;
                        } else if (pageNum > this.pageInfo.pages) {
                            validPageNum = this.pageInfo.pages;
                        }

                        this.currentPage = validPageNum;
                        this.search();
                    },

                    // insert 이벤트
                    onChangeInsertDataType: function (e) {
                        this.newObj.dataType = $(e.target).data('instance').value;
                    },
                    onChangeInsertServiceModel: function (e) {
                        this.newObj.serviceModelId = $(e.target).data('instance').value;
                    },
                    onChangeInsertContents: function (e) {

                        e.stopPropagation();

                        var newContents = e.target.value.trim();
                        e.target.value = newContents;

                        var $helperLine = $("#insert-contents-helper-line")
                        // if (newName != this.prevCode) {
                        //     this.newObj.contentsDupCheck = false;
                        //
                        //     if (this.validateContents(e.target.value)) {
                        //         this._disableInsertContentsDuplCheckBtn(false)
                        //         this._showValidationHelperLine("DUPCHECK", $helperLine, "LM 학습데이터");
                        //     } else {
                        //         this._disableInsertContentsDuplCheckBtn(true)
                        //         this._showValidationHelperLine("INVALID", $helperLine, "LM 학습데이터");
                        //         e.target.focus();
                        //     }
                        //
                        // } else {
                        //     this.newObj.contentsDupCheck = true;
                        //     this._disableInsertContentsDuplCheckBtn(true)
                        //     this._showValidationHelperLine("", $helperLine, "LM 학습데이터");
                        // }
                        this.newObj.contentsDupCheck = false;

                        if (this.validateContents(e.target.value)) {
                            this._disableInsertContentsDuplCheckBtn(false)
                            this._showValidationHelperLine("DUPCHECK", $helperLine, "LM 학습데이터");
                        } else {
                            this._disableInsertContentsDuplCheckBtn(true)
                            this._showValidationHelperLine("INVALID", $helperLine, "LM 학습데이터");
                            e.target.focus();
                        }
                        this.newObj.contents = newContents;
                    },
                    onClickInsertContentsDupCheck: function () {
                        var self = this;

                        this.checkDuplicateContents(this.newObj, function () {
                            if (self.newObj.contentsDupCheck) {
                                self._showValidationHelperLine('VALID', $("#insert-contents-helper-line"), '학습데이터');
                            } else {
                                self._showValidationHelperLine('DUPCHECK', $("#insert-contents-helper-line"), '학습데이터');
                            }
                        });
                    },
                    onChangeInsertRepeat: function (e) {

                        e.stopPropagation();
                        var newRepeat = e.target.value.trim();
                        e.target.value = newRepeat;

                        var $helperLine = $("#insert-repeat-helper-line")
                        // if (newName != this.prevCode) {
                        //     this.newObj.contentsDupCheck = false;
                        //
                        //     if (this.validateContents(e.target.value)) {
                        //         this._disableInsertContentsDuplCheckBtn(false)
                        //         this._showValidationHelperLine("DUPCHECK", $helperLine, "가중치");
                        //     } else {
                        //         this._disableInsertContentsDuplCheckBtn(true)
                        //         this._showValidationHelperLine("INVALID", $helperLine, "가중치");
                        //         e.target.focus();
                        //     }
                        //
                        // } else {
                        //     this.newObj.contentsDupCheck = true;
                        //     this._disableInsertContentsDuplCheckBtn(true)
                        //     this._showValidationHelperLine("", $helperLine, "가중치");
                        // }

                        if (this.validateRepeat(e.target.value)) {
                            this._showValidationHelperLine("VALID", $helperLine, "가중치");
                            this.newObj.repeatCount = newRepeat;
                        } else {
                            this._showValidationHelperLine("INVALID", $helperLine, "가중치");
                            e.target.focus();
                        }
                    },
                    onChangeInsertDescription: function (e) {

                        e.stopPropagation();
                        var newDescription = e.target.value;
                        //e.target.value = newDescription;

                        var $helperLine = $("#insert-description-helper-line")
                        // if (newName != this.prevCode) {
                        //     this.newObj.contentsDupCheck = false;
                        //
                        //     if (this.validateContents(e.target.value)) {
                        //         this._disableInsertContentsDuplCheckBtn(false)
                        //         this._showValidationHelperLine("DUPCHECK", $helperLine, "설명");
                        //     } else {
                        //         this._disableInsertContentsDuplCheckBtn(true)
                        //         this._showValidationHelperLine("INVALID", $helperLine, "설명");
                        //         e.target.focus();
                        //     }
                        //
                        // } else {
                        //     this.newObj.contentsDupCheck = true;
                        //     this._disableInsertContentsDuplCheckBtn(true)
                        //     this._showValidationHelperLine("", $helperLine, "설명");
                        // }

                        if (this.validateDescription(e.target.value)) {
                            this._showValidationHelperLine("VALID", $helperLine, "설명");
                            this.newObj.description = newDescription;
                        } else {
                            this._showValidationHelperLine("INVALID", $helperLine, "설명");
                            e.target.focus();
                        }

                    },
                    _disableInsertContentsDuplCheckBtn: function (disabled) {
                        $("#insert-contents-dupcheck-btn").prop("disabled", disabled);
                    },
                    _showValidationHelperLine: function (mode, $helperline, key) {
                        if (mode == "VALID") {
                            $helperline.html(
                                `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--success">
                                                        사용 가능한 ${key}입니다.
                                                    </p>`
                            )
                        } else if (mode == "DUPCHECK") {
                            $helperline.html(
                                `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--warning ">
                                                        ${key} 중복 체크를 해주세요.
                                                    </p>`
                            )
                        } else if (mode == "INVALID") {
                            $helperline.html(
                                `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--error ">
                                                        유효하지 않은 ${key}입니다.
                                                    </p>`
                            )
                        } else {
                            $helperline.html('<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg "></p>');
                        }
                    },

                    // insert bulk 이벤트
                    onClickInsertBulkExcelFileBtn: function (e) {
                        $("#insert-bulk-excel-file-input").click();
                        e.preventDefault();
                        e.stopPropagation();
                    },
                    onChangeInsertBulkExcelFile: function (e) {
                        var filename = e.target.files[0].name;
                        $("#insert-bulk-excel-file-name").data('instance').value = filename;
                    },
                    _showBulkButtons: function () {

                        var $bulkTypeHelperLine = $("#bulk-type-helper-line");
                        $bulkTypeHelperLine.html('최대 500건까지 등록 가능합니다.')
                    },

                    // update 이벤트
                    onChangeUpdateDataType: function (e) {
                        this.detailObj.dataType = $(e.target).data('instance').value;
                    },
                    onChangeUpdateServiceModel: function (e) {
                        this.detailObj.serviceModelId = ($(e.target).data('instance').value).toString();
                    },
                    onChangeUpdateContents: function (e) {

                        e.stopPropagation();
                        var newContents = e.target.value.trim();
                        e.target.value = newContents;

                        var $helperLine = $("#detail-contents-helper-line")
                        if (newContents != this.prevContent) {
                            this.detailObj.serverNameDupCheck = false;

                            if (this.validateContents(e.target.value)) {
                                this._disableUpdateContentsDuplCheckBtn(false)
                                this._showValidationHelperLine("DUPCHECK", $helperLine, "LM 학습데이터");
                            } else {
                                this._disableUpdateContentsDuplCheckBtn(true)
                                this._showValidationHelperLine("INVALID", $helperLine, "LM 학습데이터");
                                e.target.focus();
                            }

                        } else {
                            this.detailObj.serverNameDupCheck = true;
                            this._disableUpdateContentsDuplCheckBtn(true)
                            this._showValidationHelperLine("", $helperLine, "LM 학습데이터");
                        }

                        this.detailObj.contents = newContents;
                    },
                    onChangeUpdateRepeat: function (e) {

                        e.stopPropagation();
                        var newObj = e.target.value.trim();
                        e.target.value = newObj;

                        var $helperLine = $("#detail-repeat-helper-line")

                        if (this.validateRepeat(e.target.value)) {
                            this._showValidationHelperLine("", $helperLine, "가중치");
                        } else {
                            this._showValidationHelperLine("INVALID", $helperLine, "가중치");
                            e.target.focus();
                        }

                        this.detailObj.repeatCount = newObj;
                    },
                    onChangeUpdateDescription: function (e) {

                        e.stopPropagation();
                        var newObj = e.target.value;
                        //e.target.value = newObj;

                        var $helperLine = $("#detail-description-helper-line")

                        if (this.validateDescription(e.target.value)) {
                            this._showValidationHelperLine("", $helperLine, "설명");
                        } else {
                            this._showValidationHelperLine("INVALID", $helperLine, "설명");
                            e.target.focus();
                        }

                        this.detailObj.description = newObj;
                    },
                    onClickUpdateContentsDupCheck: function () {
                        var self = this;

                        this.checkDuplicateContents(this.detailObj, function () {
                            if (self.detailObj.contentsDupCheck) {
                                self._showValidationHelperLine('VALID', $("#detail-contents-helper-line"), 'LM 학습데이터');
                            } else {
                                self._showValidationHelperLine('DUPCHECK', $("#detail-contents-helper-line"), 'LM 학습데이터');
                            }
                        });
                    },
                    _disableUpdateContentsDuplCheckBtn: function (disabled) {
                        $("#detail-contents-dupcheck-btn").prop("disabled", disabled);
                    },

                    // delete 이벤트
                    onChangeDeleteServiceModel: function (e) {
                        this.deleteObj.serviceModelId = $(e.target).data('instance').value;
                    },

                    // 중복 체크
                    checkDuplicateContents: function (obj, callback) {
                        var newObj = {
                            "contents": String(obj.contents),
                            "serviceModelId": String(obj.serviceModelId)
                        }

                        $.ajax({
                            url: this.baseUrl + "/trainData/api/existContents",
                            method: "post",
                            data: newObj,
                            dataType: "json"
                        }).done(data => {
                            if (data.resultCode == "0000") {
                                obj.contentsDupCheck = true;
                            } else {
                                toastr.error("이미 등록된 학습데이터입니다.");
                            }
                            callback();
                        })
                    },
                    // 유효성 검사 (액션별)
                    validateInsert: function () {

                        // 데이터 구분
                        if (this.newObj.dataType == null || this.newObj.dataType == undefined || this.newObj.dataType == 0) {
                            toastr.error("데이터 구분을 선택해주세요.");
                            return;
                        }

                        // 서비스 모델
                        if (this.newObj.serviceModelId == null || this.newObj.serviceModelId == undefined || this.newObj.serviceModelId == 0) {
                            toastr.error("서비스 모델을 선택해주세요.")
                            return;
                        }

                        // LM 학습데이터
                        if (!this.validateContents($($("#insert-contents-input")[0].parentElement).data('instance').value)) {
                            toastr.error("LM 학습데이터 입력 형식이 맞지 않습니다. 한글(자음/모음 제외) 및 공백 포함 " + this.CONTENTS_MAX_LENGTH + "자 내외.")
                            return false;
                        }

                        if (!this.newObj.contentsDupCheck) {
                            toastr.error("LM 학습데이터 중복 체크를 진행해주세요.")
                            return false;
                        }

                        // 가중치
                        if (!this.validateRepeat($($("#insert-repeat-input")[0].parentElement).data('instance').value)) {
                            toastr.error("가중치 입력 형식이 맞지 않습니다. 0 ~ " + this.REPEAT_COUNT_MAX_VAL + "사이의 숫자")
                            return;
                        }

                        // 설명
                        if (!this.validateDescription($($("#insert-description-input")[0].parentElement).data('instance').value)) {
                            toastr.error("설명은 최대" + this.DESCRIPTION_MAX_LENGTH + "자 까지 입력 가능합니다.")
                            return;
                        }

                        return true;
                    },
                    validateInsertBulk: function () {

                        var excelFile = $("#insert-bulk-excel-file-input").val();

                        if (excelFile == null || excelFile.trim() == '') {
                            toastr.error("엑셀 파일을 업로드 해주세요.")
                            return false;
                        }

                        return true;
                    },

                    validateUpdate: function () {

                        if (this.detailObj.dataType == null || this.detailObj.dataType == undefined || this.detailObj.dataType == 0) {
                            toastr.error("데이터 구분을 선택해주세요.")
                            return;
                        }


                        if (this.detailObj.serviceModelId == null || this.detailObj.serviceModelId == undefined || this.detailObj.serviceModelId == 0) {
                            toastr.error("서비스 모델을 선택해주세요.")
                            return;
                        }

                        // LM 학습데이터
                        if (!this.validateContents($($("#detail-contents-input")[0].parentElement).data('instance').value)) {
                            toastr.error("LM 학습데이터 입력 형식이 맞지 않습니다. 한글(자음/모음 제외) 및 공백 포함 " + this.CONTENTS_MAX_LENGTH + "자 내외.")
                            return false;
                        }

                        if (!this.newObj.contentsDupCheck) {
                            toastr.error("LM 학습데이터 중복 체크를 진행해주세요.")
                            return false;
                        }

                        // 가중치
                        if (!this.validateRepeat($($("#insert-repeat-input")[0].parentElement).data('instance').value)) {
                            toastr.error("가중치 입력 형식이 맞지 않습니다. 0 ~ " + this.REPEAT_COUNT_MAX_VAL + "사이의 숫자")
                            return;
                        }

                        // 설명
                        if (!this.validateDescription($($("#insert-description-input")[0].parentElement).data('instance').value)) {
                            toastr.error("설명은 최대" + this.DESCRIPTION_MAX_LENGTH + "자 까지 입력 가능합니다.")
                            return;
                        }

                        return true;
                    },
                    validateDelete: function () {

                        // 서비스 모델
                        if (this.deleteObj.serviceModelId == null || this.deleteObj.serviceModelId == undefined || this.deleteObj.serviceModelId == 0) {
                            toastr.error("서비스 모델을 선택해주세요.")
                            return;
                        }

                        return true;
                    },
                    // 유효성 검사 (필드별)
                    validateContents: function (value) {
                        // 최대 글자, 빈 값, 한글(자음/모음 제외)만 입력 가능
                        var regexp = /^[가-힣\s]+$/gi;
                        var newValue = value.trim();

                        return newValue.length <= this.CONTENTS_MAX_LENGTH && newValue.length > 0 && regexp.test(newValue);
                    },
                    validateRepeat: function (value) {
                        // 최대 글자, 빈 값, 1 ~ 10,000만 입력 가능
                        if (value == null || value == undefined || value.length == 0) {
                            return false;
                        }
                        var regexp = /^[0-9]+$/;
                        var newValue = Number(value.trim());

                        return newValue <= this.REPEAT_COUNT_MAX_VAL && newValue > 0 && regexp.test(newValue);
                    },
                    validateDescription: function (value) {
                        // 최대 글자
                        var newValue = value.trim();
                        return newValue.length <= this.DESCRIPTION_MAX_LENGTH;
                    },
                    _showInsertContentsValidation: function (mode) {
                        var $herlperline = $("#insert-contents-helper-line");
                        if (mode == "VALID") {
                            $herlperline.html(
                                `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--success">
                                    입력 가능한 LM 학습데이터입니다.
                                </p>`
                            )
                        } else if (mode == "DUPCHECK") {
                            $herlperline.html(
                                `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--warning ">
                                    LM 학습데이터 중복 체크를 해주세요.
                                </p>`
                            )
                        } else if (mode == "INVALID") {
                            $herlperline.html(
                                `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--error ">
                                    입력 형식에 맞지 않는 LM 학습데이터입니다. 한글(자음/모음 제외) 및 255자 내외만 입력 가능합니다.
                                </p>`
                            )
                        } else {
                            $herlperline.html('<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg "></p>');
                        }
                    },

                    // 상세 페이지 오픈
                    openDetailDialog: function (trainDataId) {
                        var self = this;
                        this.detail(trainDataId, () => self.detailDialog.open());
                    },
                    selectAllRows: function () {
                        var toggle = $("#toggleDelete").is(':checked');

                        $('.deleteChk:checkbox').each(function () {
                            $(this).prop('checked', toggle);
                        });
                    },
                    convertDataTypeLabel: function (key) {
                        var value = ""
                        this.dataTypes.forEach(model => {
                            if (model.key == key) {
                                value = model.value;
                            }
                        })
                        return value;
                    },
                    convertServiceModelLabel: function (key) {
                        var value = ""
                        this.serviceModels.forEach(model => {
                            if (model.key == key) {
                                value = model.value;
                            }
                        })
                        return value;
                    },
                    initCheckBox: function () {
                        $("#toggleDelete").prop('checked', false);
                        $('.deleteChk:checkbox').each(function () {
                            $(this).prop('checked', false);
                        });
                    },

					/**
					 * 모달 닫을 때 데이터 요청/전송 취소
					 */
					onCloseDialog: function () {
						const self = this;
						if (self.currentXhr.length !== 0) {
							if (self.checkXhrAbort && !confirm('취소 시 저장 및 업로드가 중단됩니다.')) return;
							[...self.currentXhr].forEach(xhrItem => xhrItem.xhr.abort())
							self.dispatchProcessing('done');
						}
						if (self.currentDialog) {
							self[self.currentDialog].close();
							self.currentDialog = null;
						}
					},

					/**
					 *
					 * @param state: 'process' || 'done'
					 * 디스패치 시 모달 본문에 유저 동작 방지 적용 및 닫기/취소를 제외한 버튼 비활성화
					 */
					dispatchProcessing: function (state) {
						let $modalSurface;
						let $modalBtn;
						if (state === 'process') {
							// 닫기/취소를 제외한 버튼 선택
							$modalBtn = $('.mdc-dialog--open .mdc-dialog__surface .mdc-button').not('.close-button');
							// 현재 열려있는 모달 선택
							$modalSurface = $('.mdc-dialog--open .mdc-dialog__surface');
							$modalBtn.prop('disabled', true);
							$modalSurface.addClass('is-processing');
						} else if (state === 'done') {
							// 진행 중인 모달 선택.
							// 모달 닫는게 먼저 실행되면 .mdc-dialog--open으로 선택 불가
							$modalBtn = $('.mdc-dialog__surface.is-processing .mdc-button').not('.close-button');
							$modalSurface = $('.mdc-dialog__surface.is-processing');
							$modalBtn.prop('disabled', false);
							$modalSurface.removeClass('is-processing');
						}
					},
                }
            });
        })();
	</script>
</th:block>


</html>

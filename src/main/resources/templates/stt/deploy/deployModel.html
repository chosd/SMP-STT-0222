<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layouts/nolayout">
<th:block layout:fragment="html">
  <div class="contentRoot">
    <div class="content-header">
        <h2>배포모델 관리</h2>
      <div class="button-group">
        <!--등록-->
        <button id="insert-dialog-btn" class="mdc-button mdc-button--outlined mdc-ripple-upgraded">
          <span class="mdc-button__ripple"></span>
          <i class="material-icons mdc-button__icon me-1">add</i>
          <span class="mdc-button__label">등록</span>
        </button>
      </div>
    </div>

    <div class="content-body">
      <div class="card">
        <div class="card-header pb-4">
          <div class="form-row md-size multiline-align-top">
            <!-- >> 서비스 모델 검색 -->
            <div class="mdc-select mdc-select--outlined mdc-select--no-label" id="serviceModels-mdc-select">
              <div class="mdc-select__anchor">
                <div class="mdc-notched-outline">
                  <span class="mdc-notched-outline__leading"></span>
                  <div class="mdc-notched-outline__notch">
                    <label class="mdc-floating-label">서비스 모델</label>
                  </div>
                  <span class="mdc-notched-outline__trailing"></span>
                </div>
                <span class="mdc-select__selected-text-container overflow-hidden">
                      <span class="mdc-select__selected-text"></span>
                  </span>
                <span class="mdc-select__dropdown-icon"></span>
              </div>

              <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
                <ul class="mdc-deprecated-list">
                  <li class="mdc-deprecated-list-item" data-value="''" @click="searchCondition.serviceModelId=''"
                      :class="{'mdc-deprecated-list-item--selected': searchCondition.serviceModelId==''}"
                      :aria-selected="searchCondition.serviceModelId=='' ? 'true' : 'false'">
                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span class="mdc-deprecated-list-item__text">전체</span>
                  </li>
                  <li v-for="serviceModel in serviceModelList" class="mdc-deprecated-list-item"
                      :data-value="serviceModel.serviceCode"
                      @click="searchCondition.serviceModelId = serviceModel.serviceCode"
                      :class="{'mdc-deprecated-list-item--selected': searchCondition.serviceModelId == serviceModel.serviceCode} "
                      :aria-selected="searchCondition.serviceModelId == serviceModel.serviceCode ? 'true' : 'false'">

                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span class="mdc-deprecated-list-item__text">{{ serviceModel.serviceModelName }}</span>
                  </li>
                </ul>
              </div>
            </div>
            <!-- << 서비스 모델 검색 -->

            <!-- << 작성자 검색 -->
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto search-bar">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text"
                     v-model="searchCondition.uploadedBy"/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">작성자</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
            <!-- << 설명 검색 -->

            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto search-bar">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text"
                     v-model="searchCondition.description"/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">설명</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
            <!-- << 설명 검색 -->

            <!-- >> 등록일 검색 -->
            <div class="flex-auto flex-ratio-two">
              <div class="form-row h-100">
                <div id="train-start-date-mdc"
                     class="mdc-text-field text-field mdc-text-field--outlined mdc-text-field--with-leading-icon w-100">
                  <i class="material-icons mdc-text-field__icon">event</i>
                  <input type="text" class="mdc-text-field__input"
                         aria-describedby="text-field-outlined-shape-one-helper-text"/>
                  <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                    <div class="mdc-notched-outline__leading"></div>
                    <div class="mdc-notched-outline__notch">
                      <label class="mdc-floating-label">등록일(from)</label>
                    </div>
                    <div class="mdc-notched-outline__trailing"></div>
                  </div>
                </div>
                <div id="train-end-date-mdc"
                     class="mdc-text-field text-field mdc-text-field--outlined mdc-text-field--with-leading-icon w-100">
                  <i class="material-icons mdc-text-field__icon">event</i>
                  <input type="text" class="mdc-text-field__input"
                         aria-describedby="text-field-outlined-shape-one-helper-text"/>
                  <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                    <div class="mdc-notched-outline__leading"></div>
                    <div class="mdc-notched-outline__notch">
                      <label class="mdc-floating-label">등록일(to)</label>
                    </div>
                    <div class="mdc-notched-outline__trailing"></div>
                  </div>
                </div>
              </div>
              <div class="mdc-text-field-helper-line">
                <p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg">
                  등록일이 없는 경우는 전체 기간을 뜻합니다.
                </p>
              </div>
            </div>
            <!-- << 등록일 검색 -->

            <!-- << 검색 버튼 -->
            <button class="mdc-button mdc-button--unelevated mdc-ripple-upgraded" @click="search(true)">
              <span class="mdc-button__ripple"></span>
              <i class="material-icons mdc-button__icon me-1">search</i>
              <span class="mdc-button__label">검색</span>
            </button>
            <!-- << 검색 버튼 -->
          </div>
        </div>
        <div class="card-body">
          <div class="table-controls form-row md-size">
            <!--검색 결과-->
            <div class="table-result-info flex-auto">
              <h4>검색결과 : <span>{{ pageInfo.total }}</span>건</h4>
            </div>
            <!--선택 삭제-->
            <button
                class="mdc-button mdc-button--outlined mdc-ripple-upgraded mdc-theme--error"
                @click="deleteSelected">
              <span class="mdc-button__ripple"></span>
              <i class="material-icons mdc-button__icon">delete</i>
              <span class="mdc-button__label">선택 삭제</span>
            </button>
            <!-- >>> 페이지 사이즈 조절 -->
            <div class="mdc-select mdc-select--outlined mdc-select--no-label">
              <div class="mdc-select__anchor">
                <div class="mdc-notched-outline">
                  <span class="mdc-notched-outline__leading"></span>
                  <div class="mdc-notched-outline__notch">
                    <label class="mdc-floating-label">레코드 수</label>
                  </div>
                  <span class="mdc-notched-outline__trailing"></span>
                </div>
                <span class="mdc-select__selected-text-container overflow-hidden">
                          <span class="mdc-select__selected-text"></span>
                  </span>
                <span class="mdc-select__dropdown-icon"></span>
              </div>
              <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
                <ul class="mdc-deprecated-list">
                  <li v-for="ps in pageSizes" class="mdc-deprecated-list-item"
                      :data-value="ps"
                      @click="searchCondition.pageSize = ps; currentPage = 1; search();"
                      :class="{'mdc-deprecated-list-item--selected': searchCondition.pageSize == ps} "
                      :aria-selected="searchCondition.pageSize == ps ? 'true' : 'false'">
                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span class="mdc-deprecated-list-item__text">{{ ps }}개</span>
                  </li>

                </ul>
              </div>
            </div>
            <!-- <<< 페이지 사이즈 조절 -->
          </div>

          <!-- 목록 테이블 -->
          <div class="table-container">
            <div class="mdc-data-table">
              <div class="mdc-data-table__table-container">
                <table class="mdc-data-table__table">
                  <thead>
                  <tr class="mdc-data-table__header-row">
                    <th class="mdc-data-table__header-cell mdc-data-table__header-cell--checkbox text-center" role="columnheader" scope="col">
                      <div class="mdc-form-field">
                        <div
                            class="mdc-checkbox mdc-data-table__header-row-checkbox mdc-checkbox--upgraded mdc-checkbox--selected mdc-ripple-upgraded mdc-ripple-upgraded--unbounded">
                          <input type="checkbox" class="mdc-checkbox__native-control" aria-checked="mixed"
                                 @click="selectAllRows" id="toggleDelete"/>
                          <div class="mdc-checkbox__background">
                            <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
                              <path class="mdc-checkbox__checkmark-path" fill="none"
                                    d="M1.73,12.91 8.1,19.28 22.79,4.59"></path>
                            </svg>
                            <div class="mdc-checkbox__mixedmark"></div>
                          </div>
                          <div class="mdc-checkbox__ripple"></div>
                        </div>
                      </div>
                    </th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">No.</th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">서비스 모델</th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">모델타입</th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">설명</th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">작성자</th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">등록일시</th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">학습데이터 양</th>
                    <th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">모델 ID</th>
                    <!--th class="mdc-data-table__header-cell text-center" role="columnheader" scope="col">모델 다운로드</th-->
                  </tr>
                  </thead>
                  <tbody class="mdc-data-table__content">
                  <tr v-if="searchResults.length == 0" class="mdc-data-table__row" aria-selected="false"
                      style="cursor: pointer;">
                    <td class="mdc-data-table__cell text-center" colspan="9">검색된 결과가 없습니다.</td>
                  </tr>
                  <tr v-else v-for="(row, i) in searchResults" class="detail-service-row mdc-data-table__row"
                      aria-selected="false" style="cursor: pointer;">
                    <td class="mdc-data-table__cell mdc-data-table__cell--checkbox">
                      <div
                          class="mdc-checkbox mdc-data-table__row-checkbox mdc-checkbox--upgraded mdc-ripple-upgraded mdc-ripple-upgraded--unbounded">
                        <input type="checkbox" class="mdc-checkbox__native-control deleteChk"
                               aria-labelledby="u60" :value="row.id"/>
                        <div class="mdc-checkbox__background">
                          <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
                            <path class="mdc-checkbox__checkmark-path" fill="none"
                                  d="M1.73,12.91 8.1,19.28 22.79,4.59"></path>
                          </svg>
                          <div class="mdc-checkbox__mixedmark"></div>
                        </div>
                        <div class="mdc-checkbox__ripple"></div>
                      </div>
                    </td>
                    </td>
                    <td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
                      {{ pageInfo.total - ( (currentPage - 1) * searchCondition.pageSize + i) }}
                    </td>
                    <td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
                      {{ convertServiceModelCode2Name(row.serviceModelId) }}
                    </td>
                    <td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
                      {{ row.modelType }}
                    </td>
                    <td class="mdc-data-table__cell" @click="() => openDetailDialog(row.id)">
                      {{ row.description }}
                    </td>
                    <td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
                      {{ row.uploadedBy }}
                    </td>
                    <td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
                      {{ row.uploadedDate }}
                    </td>
                    <td v-if="row.modelType == 'CLASS' || row.modelType == 'SERVICE' || row.modelType == 'E2ELM'"
                    	class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
                      {{ row.dataNum }}건
                    </td>
                    <td v-if="row.modelType == 'E2ESL' || row.modelType == 'E2EUSL' || row.modelType == 'E2EMSL'"
                    	class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
                      {{ row.dataTime }}
                    </td>
                    <td class="mdc-data-table__cell text-center" @click="() => openDetailDialog(row.id)">
                      {{ row.resultModelId }}
                    </td>
                    
                    <!--td class="mdc-data-table__cell text-center">
                      <button class="mdc-button mdc-button--icon-leading"
                              @click="() => requestResultModelDownload(row.resultModelId)">
                        <span class="mdc-button__ripple"></span>
                        <span class="mdc-button__focus-ring"></span>
                        <i class="material-icons mdc-button__icon" aria-hidden="true">download</i>
                        <span class="mdc-button__label">다운로드</span>
                      </button>
                    </td-->
                    
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- pagination -->
          <div class="table-pagination mdc-data-table__pagination">
            <div class="mdc-data-table__pagination-trailing mdc-chip-set mdc-chip-set--choice">
              <div class="mdc-data-table__pagination-navigation">
                <button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
                        data-first-page="true" @click="gotoPage(1)">
                  <div class="mdc-button__icon">first_page</div>
                </button>
                <button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
                        data-prev-page="true" @click="gotoPage(currentPage - 1)">
                  <div class="mdc-button__icon">chevron_left</div>
                </button>

                <button v-for="(paging, index) in pages"
                        class="mdc-chip mdc-data-table__pagination-button fs-6 bg-transparent"
                        :class="{ 'mdc-chip--selected' : paging == currentPage }"
                        @click="gotoPage(paging)">
                  {{ paging }}
                </button>
                <button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
                        data-next-page="true" @click="gotoPage(currentPage + 1)">
                  <div class="mdc-button__icon">chevron_right</div>
                </button>
                <button class="mdc-icon-button material-icons mdc-data-table__pagination-button fs-6"
                        data-last-page="true" @click="gotoPage(pageInfo.pages)">
                  <div class="mdc-button__icon">last_page</div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- >>> 등록 팝업 -->
  <div id="insert-dialog" class="mdc-dialog" role="alertdialog" aria-modal="true"
       aria-labelledby="simple-dialog-label" aria-describedby="simple-dialog-description" tabindex="-1">
    <div class="mdc-dialog__scrim"></div>
    <div class="mdc-dialog__container">
      <div class="mdc-dialog__surface">
        <div class="mdc-dialog__header">
          <h2 class="mdc-dialog__title">모델 등록</h2>
          <button class="mdc-icon-button material-icons close-button" tabindex="-1">
            close
          </button>
		</div>
		<!-- loading bar -->
		<div id="insert-deploy-model-dialog-loadingbar" role="progressbar" class="mdc-linear-progress mdc-linear-progress--indeterminate"
			hidden>
			<div class="mdc-linear-progress__buffering-dots"></div>
			<div class="mdc-linear-progress__buffer"></div>
			<div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
				<span class="mdc-linear-progress__bar-inner"></span>
			</div>
			<div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
				<span class="mdc-linear-progress__bar-inner"></span>
			</div>
		</div>
        <section class="mdc-dialog__content form-row-stack">
          <p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-theme--error">
            *모든 항목은 필수입력사항입니다.
          </p>

          <!-- 모델 -->
          <div class="form-row">
            <input id="insert-file-input" type="file" class="d-none" accept=".zip,.ZIP"/>
            <div id="insert-file-name"
                 class="mdc-text-field text-field mdc-text-field--outlined mdc-text-field--with-leading-icon flex-auto">
              <i class="mdc-text-field__icon material-icons">attach_file</i>
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" required/>
              <label for="insert-file-input" class="w-100 h-100 position-absolute"
                     style="z-index: 2; cursor: pointer"></label>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">모델(ZIP)</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <!-- 서비스 모델 -->
          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="insert-service-model"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">서비스 모델</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="insert-data-num"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">학습데이터 양</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

			<div class="form-row" >
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto">
              <input id="insert-modelType" type="text" class="mdc-text-field__input" aria-describedby="text-field-outlined-shape-one-helper-text" readonly required value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">모델타입</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>


          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="insert-result-model-id"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">모델 ID</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <!--설명-->
          <div class="form-row multiline-align-top flex-auto">
            <div class="flex-auto">
              <div class="mdc-text-field text-field mdc-text-field--outlined w-100">
                <input required type="text" class="mdc-text-field__input"
                       aria-describedby="text-field-outlined-shape-one-helper-text"
                       id="insert-description-input"
                />
                <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                  <div class="mdc-notched-outline__leading"></div>
                  <div class="mdc-notched-outline__notch">
                    <label class="mdc-floating-label">설명</label>
                  </div>
                  <div class="mdc-notched-outline__trailing"></div>
                </div>
              </div>
              <div class="mdc-text-field-helper-line" id="insert-description-helper-line">
              </div>
            </div>
          </div>

          <!--modelAuthKey-->
          <div style="display: none" class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="insert-modelAuthKey-input"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">modelAuthKey</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <!--modelFileName-->
          <div style="display: none" class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined w-100 ">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="insert-modelFileName-input"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">modelFileName</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>
        </section>
        <footer class="mdc-dialog__actions">
          <button id="insert-btn" class="mdc-button mdc-button--unelevated mdc-ripple-upgraded">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">등록</span>
          </button>
          <button class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-default mdc-theme--default-bg close-button">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">취소</span>
          </button>
        </footer>
      </div>
    </div>
  </div>
  <!-- <<< 등록 팝업 -->

  <!-- >>> 상세 팝업 -->
  <div id="detail-dialog" class="mdc-dialog mdc-dialog--scrollable" role="alertdialog" aria-modal="true"
       aria-labelledby="simple-dialog-label" aria-describedby="simple-dialog-description" tabindex="-1">
    <div class="mdc-dialog__scrim"></div>
    <div class="mdc-dialog__container">
      <div class="mdc-dialog__surface">
        <div class="mdc-dialog__header">
          <h2 class="mdc-dialog__title">모델 상세</h2>
          <button class="mdc-icon-button material-icons close-button" tabindex="-1">
            close
          </button>
        </div>
       	<!-- loading bar -->
		<div id="update-deploy-model-dialog-loadingbar" role="progressbar" class="mdc-linear-progress mdc-linear-progress--indeterminate"
			hidden>
			<div class="mdc-linear-progress__buffering-dots"></div>
			<div class="mdc-linear-progress__buffer"></div>
			<div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
				<span class="mdc-linear-progress__bar-inner"></span>
			</div>
			<div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
				<span class="mdc-linear-progress__bar-inner"></span>
			</div>
		</div>
        <section class="mdc-dialog__content form-row-stack">
          <p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-theme--error">
            *모든 항목은 필수입력사항입니다.
          </p>

          <!-- 상세팝업 서비스 모델 -->
          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-service-model"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">서비스 모델</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>
			<!-- 상세팝업 학습데이터 양 -->
          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-data-num"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">학습데이터 양</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>
          <!-- 상세팝업 모델타입 -->
          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-modelType"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">모델타입</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>
			<!-- 상세팝업 모델ID -->
          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-result-model-id"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">모델 ID</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>

          <!-- 상세팝업 설명-->
          <div class="form-row multiline-align-top flex-auto">
            <div class="flex-auto">
              <div class="mdc-text-field text-field mdc-text-field--outlined w-100">
                <input required type="text" class="mdc-text-field__input"
                       aria-describedby="text-field-outlined-shape-one-helper-text"
                       id="detail-description-input"
                />
                <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                  <div class="mdc-notched-outline__leading"></div>
                  <div class="mdc-notched-outline__notch">
                    <label class="mdc-floating-label">설명</label>
                  </div>
                  <div class="mdc-notched-outline__trailing"></div>
                </div>
              </div>
              <div class="mdc-text-field-helper-line" id="detail-description-helper-line">
              </div>
            </div>
          </div>

          <!-- 작성자 -->
          <div class="form-row">
            <div class="mdc-text-field text-field mdc-text-field--outlined flex-auto">
              <input type="text" class="mdc-text-field__input"
                     aria-describedby="text-field-outlined-shape-one-helper-text" readonly required
                     id="detail-uploaded-by"
                     value=""/>
              <div class="mdc-notched-outline mdc-notched-outline--upgraded">
                <div class="mdc-notched-outline__leading"></div>
                <div class="mdc-notched-outline__notch">
                  <label class="mdc-floating-label">작성자</label>
                </div>
                <div class="mdc-notched-outline__trailing"></div>
              </div>
            </div>
          </div>
        </section>
        <footer class="mdc-dialog__actions">
          <button
                  class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-error mdc-theme--error-bg"
                  id="delete-btn">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">삭제</span>
          </button>
          <button class="mdc-button mdc-button--unelevated mdc-ripple-upgraded mdc-theme--on-default mdc-theme--default-bg dialog-close-btn close-button">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">취소</span>
          </button>
          <button id="update-btn" class="mdc-button mdc-button--unelevated mdc-ripple-upgraded">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__label">수정</span>
          </button>
        </footer>
      </div>
    </div>
  </div>
  <!-- <<< 상세 팝업 -->

  <input type="hidden" readonly id="smpServiceUriPrefix" th:value="${smpServiceUriPrefix}">
  <input type="hidden" readonly id="defaultPageSize" th:value="${defaultPageSize}">
</th:block>

<th:block layout:fragment="script">
  <script type="text/javascript">
    (function () {
      var LABEL = {
        searchCondition: {
          serviceModelId: "",
          uploadedBy: "",
          description : "",
          from: "",
          to: "",
          pageSize: $("#defaultPageSize").val()
        },
        detailObj: {
          serviceModelId: "",
          description: "",
          updatedBy: "",
          dataNum: "",
          resultModelId: ""
        },
        insertRequest: {
          serviceModelId: "",
          dataNum: "",
          dataTime: "",
          modelType: "",
          resultModelId: "",
          description: "",
          modelAuthKey: "",
          modelFileName: ""
        }
      };
      new Vue({
        el: ".contentRoot",
        data: {
          // 팝업
          insertDialog: mdc.dialog.MDCDialog.attachTo(document.querySelector('#insert-dialog')),
          detailDialog: mdc.dialog.MDCDialog.attachTo(document.querySelector('#detail-dialog')),
          insertDeployModelDialogLoadingBar: $("#insert-deploy-model-dialog-loadingbar"),
          updateDeployModelDialogLoadingBar: $("#update-deploy-model-dialog-loadingbar"),

          // 검색
          searchCondition: {...LABEL.searchCondition},
          searching: false,
          searchResults: [],

          // pagination
          pageSizes: [10, 20, 30, 40, 50],
          currentPage: 1,
          pageInfo: {
            pages: 1,
            total: 1
          },
          pageNumLists: [1],

          // 검색 조건
          serviceModelList: JSON.parse("[[${serviceModelList}]]".replaceAll('&quot;', "\"")),
          SERVICE_MODEL_CODE_TO_NAME: {},
          SERVICE_MODEL_ID_TO_NAME: {},
          SERVICE_MODEL_NAME_TO_ID: {},
          SERVICE_MODEL_NAME_TO_CODE: {},
          newObj: {...LABEL.insertRequest},
          detailObj: {...LABEL.detailObj},

		  checkDupModelId: "",
			
          // constant
          DESCRIPTION_MAX_LENGTH: 255,

          // etc
          currentXhr: [],		// 모달 내 XHR 중단할 때 사용
          checkXhrAbort: false,	// 모달 내에서 등록/저장 등 업로드 시엔 컨펌 추가
          currentDialog: null   // vue data에서 정의한 모달의 key. ( :string)
        },
        computed: {
          pages: function () {
            const list = [];
            for (let index = this.startPage; index <= this.endPage; index += 1) {
              list.push(index);
            }
            return list;
          },
          startPage() {
            return parseInt((this.currentPage - 1) / 5) * 5 + 1;
          },
          endPage() {
            var lastPage = parseInt((this.currentPage - 1) / 5 + 1) * 5;
            return lastPage <= this.pageInfo.pages ? lastPage : this.pageInfo.pages;
          }
        },
        created: function () {
          // Base url 받아오기
          const baseUrl = document.querySelector('#smpServiceUriPrefix').value;
          this.baseUrl = baseUrl;

          // 데이터 구분 목록 받아오기
          var self = this;

          this.initServiceModel()

          this.search();
        },
        mounted: function () {

          // 페이지 이동시 처리
          $('#drawer-main-content-viewer').one('page.move', function () {

            // MaterialDatepicker가 화면을 종료해도 자동으로 종료되지 않아 이벤트 unbinding 추가
            var $trainStartDateMdc = $('#train-start-date-mdc');
            var $trainEndDateMdc = $('#train-end-date-mdc');
            $trainStartDateMdc.data('datepicker').destroy();
            $trainEndDateMdc.data('datepicker').destroy();
          });
          this.initMaterialUx();
          this.initSearchBarEvents();

          var self = this;

          // >>> 등록 dialog 설정
          var insertDialog = this.insertDialog;

          /*$('#insert-dialog-btn').off('click').on('click', function () {
            insertDialog.open();
          });*/

          insertDialog.listen('MDCDialog:opening', function () {

            // 화면 및 데이터 초기화
            self.initializeInsertDialog();

            // component 이벤트 등록
            $("#insert-file-input").off('change').on('change', self.onChangeInsertFile);
            $("#insert-description-input").off('keyup').on('keyup', self.onChangeInsertDescription)

            $("#insert-btn").off('click').on('click', self.insert)
          });

          $('#insert-dialog-btn').off('click').on('click', function () {
            self.insertDialog.open();
            self.currentDialog = 'insertDialog';
          });
          // <<< 등록 dialog 설정

          // >>> 상세 dialog 설정
          var detailDialog = this.detailDialog;
          detailDialog.listen('MDCDialog:opening', function () {
            // 화면 및 데이터 초기화
            self.initializeUpdateDialog();
            self.currentDialog = 'detailDialog';

            // 이벤트 등록
            $("#detail-description-input").off('keyup').on('keyup', self.onChangeUpdateDescription)

            $("#update-btn").off('click').on('click', self.update)
            $("#delete-btn").off('click').on('click', self.delete)
          });
          // <<< 상세 dialog 설정

          // 모달 닫기 및 xhr 종료 이벤트 바인딩
          $('.close-button').off('click').on('click', function () {
            self.onCloseDialog();
          })
          $('.mdc-dialog').on('keydown', function (e) {
            if (e.key === 'Escape') self.onCloseDialog();
          })
        },
        methods: {
          initMaterialUx: function () {
            // ripple material ux 적용
            const elements = document.querySelectorAll('.mdc-ripple-upgraded');
            for (const el of elements) {
              el.class
              mdc.ripple.MDCRipple.attachTo(el, el.classList.contains('mdc-ripple-upgraded--unbounded') ? {
                isUnbounded: true
              } : void 0);
            }

            // input text material ux 적용
            const textFields = document.querySelectorAll('.mdc-text-field');
            for (const textField of textFields) {
              const mdcTextField = mdc.textField.MDCTextField.attachTo(textField);
              $(textField).data('instance', mdcTextField);
            }

            // select material ux 적용
            const selects = document.querySelectorAll('.mdc-select');
            for (const el of selects) {
              const select = mdc.select.MDCSelect.attachTo(el);
              $(el).data('instance', select); //
            }

            // linear progress material ux 적용
            const progresses = document.querySelectorAll('.mdc-linear-progress');
            for (const el of progresses) {
              const progress = mdc.linearProgress.MDCLinearProgress.attachTo(el);
              $(el).data('instance', progress); //
            }

            // dialog에 close 이벤트 주는 방법: escape key, dialog 외부 클릭 막기.
            this.insertDialog.scrimClickAction = "";
            this.detailDialog.scrimClickAction = "";

            this.initMaterialDatepickers();
          },

          // 팝업 데이터 초기화
          initServiceModel: function () {
            for (var i = 0; i < this.serviceModelList.length; i++) {
              var serviceModel = this.serviceModelList[i];

			  this.SERVICE_MODEL_CODE_TO_NAME[serviceModel.serviceCode] = serviceModel.serviceModelName;
              this.SERVICE_MODEL_ID_TO_NAME[serviceModel.serviceModelId] = serviceModel.serviceModelName;
              this.SERVICE_MODEL_NAME_TO_ID[serviceModel.serviceModelName] = serviceModel.id;
              this.SERVICE_MODEL_NAME_TO_CODE[serviceModel.serviceModelName] = serviceModel.serviceCode;
            }
          },

          // 검색
          search: function (isSearchBtnClicked) {
            this._setSearching(true);

            var searchConditions = {...this.searchCondition}
            
            if(isSearchBtnClicked) {
              searchConditions['page'] = 1;
            } else {
              searchConditions['page'] = this.currentPage;
            }
            

            commonObject.deleteNullOrDefaultFields(searchConditions);
            var queryString = Qs.stringify(searchConditions);

            $.ajax({
              url: this.baseUrl + "/deploy/model/api/listPage?" + queryString,
              method: "get",
              contentType: 'application/json; charset=UTF-8',
              dataType: "json"
            }).done(data => {
              this._setSearchResultsPageInfo(data); // 검색 결과 페이지 정보 저장
              this._setSearchResults(data.result);  // 검색 결과 목록
              this.unCheckAllCheckboxs();		    // 체크박스 초기화
            }).always(() => {
              this._setSearching(false);
            })
          },

          // 상세
          detail: function (deployModelId, callback) {
            $.ajax({
              url: this.baseUrl + "/deploy/model/api/" + deployModelId,
              method: "get",
              contentType: 'application/json; charset=UTF-8',
              dataType: "json",
            }).done(result => {
            	this.detailObj = {...result.result};
              	callback();
            });
          },

          // 등록
          insert: function (e) {
            if (!this.validateInsert()) {
              //console.log(">>>>>> before insert ajax : " , this.newObj);
              return;
            }

            if (!confirm("모델 등록하시겠습니까?")) {
              return;
            }

            var formData = new FormData();
            var $fileInput = $("#insert-file-input");
            var file = $fileInput.prop("files")[0];

            if (file != undefined && file != null) {
              formData.append("modelFile", $fileInput.prop("files")[0]);
            } else {
              return false;
            }

            var insertObj = {...this.newObj}

            formData.append("properties", new Blob([JSON.stringify(insertObj)], {type: "application/json"}));

            this.setDialogLoading(this.insertDeployModelDialogLoadingBar, true);
            this.checkXhrAbort = true;
            this.dispatchProcessing('process');
            let apiUrl = this.baseUrl + "/deploy/model/api/insert";
            var self = this;
            let xhr = $.ajax({
              url: apiUrl,
              method: "post",
              processData: false,
              contentType: false,
              cache: false,
              enctype: 'multipart/form-data',
              dataType: "json",
              data: formData
            }).done(result => {
              if (result.resultCode == "0000" || result.resultCode.startsWith("00")) {
                toastr.success(result.resultMsg);
                this.insertDialog.close();
              } else {
                toastr.error(result.resultMsg);
              }
            }).always(() => {
              this.setDialogLoading(this.insertDeployModelDialogLoadingBar, false);
              this.search();
              // 배열에서 해당 xhr 제거 및 checkXhrAbort 초기화
              let result = self.currentXhr.find(obj => obj.id === apiUrl);
              if (result) {
                let index = self.currentXhr.indexOf(result);
                self.currentXhr.splice(index, 1);
              }
              self.checkXhrAbort = false;
              self.dispatchProcessing('done');
            });
            // abort 적용을 위해 xhr 객체에 id를 추가해 배열에 push
            let result = {id: apiUrl, xhr};
            self.currentXhr.push(result);

            e.preventDefault();
            e.stopPropagation();
          },

          // 수정
          update: function (e) {
            if (!this.validateUpdate()) {
              return;
            }

            var updateObj = {...this.detailObj}

            if (confirm("수정하시겠습니까?")) {
              this.setDialogLoading(this.updateDeployModelDialogLoadingBar, true);
              this.checkXhrAbort = true;
              this.dispatchProcessing('process');
              let apiUrl = this.baseUrl + "/deploy/model/api/update";
              var self = this;
              let xhr = $.ajax({
                url: apiUrl,
                method: "post",
                contentType: 'application/json; charset=UTF-8',
                dataType: "json",
                data: JSON.stringify(updateObj)
              }).done(result => {
                if (result.resultCode == "0000") {
                  toastr.success(result.resultMsg);
                  this.detailDialog.close();
                } else {
                  toastr.error(result.resultMsg);
                }
              }).always(() => {
				this.setDialogLoading(this.updateDeployModelDialogLoadingBar, false);
                this.search();
                // 배열에서 해당 xhr 제거 및 checkXhrAbort 초기화
                let result = self.currentXhr.find(obj => obj.id === apiUrl);
                if (result) {
                  let index = self.currentXhr.indexOf(result);
                  self.currentXhr.splice(index, 1);
                }
                self.checkXhrAbort = false;
                self.dispatchProcessing('done');
              });
              // abort 적용을 위해 xhr 객체에 id를 추가해 배열에 push
              let result = {id: apiUrl, xhr};
              self.currentXhr.push(result);
            }
          },

          // 삭제
          delete: function () {

            var deployModelId = this.detailObj.id;
            var modelIdList = [deployModelId];
            var postBody = {
              modelIdList: modelIdList
            };

            if (confirm("삭제하시겠습니까?")) {
              this.setDialogLoading(this.updateDeployModelDialogLoadingBar, true);
              this.checkXhrAbort = true;
              this.dispatchProcessing('process');
              let apiUrl = this.baseUrl + "/deploy/model/api/delete";
              var self = this;
              let xhr = $.ajax({
                url: apiUrl,
                method: "post",
                contentType: 'application/json; charset=UTF-8',
                dataType: "json",
                data: JSON.stringify(postBody)
              }).done(result => {
                if (result.resultCode == "0000") {
                  toastr.success(result.resultMsg);
                } else {
                  toastr.error(result.resultMsg);
                }

                this.detailDialog.close();
              }).always(() => {
				this.setDialogLoading(this.updateDeployModelDialogLoadingBar, false);
                this.search();
                // 배열에서 해당 xhr 제거 및 checkXhrAbort 초기화
                let result = self.currentXhr.find(obj => obj.id === apiUrl);
                if (result) {
                  let index = self.currentXhr.indexOf(result);
                  self.currentXhr.splice(index, 1);
                }
                self.checkXhrAbort = false;
                self.dispatchProcessing('done');
              });
              // abort 적용을 위해 xhr 객체에 id를 추가해 배열에 push
              let result = {id: apiUrl, xhr};
              self.currentXhr.push(result);
            }
          },

          // 선택 삭제
          deleteSelected: function () {

            var modelIdList = $.map($('.deleteChk:checkbox:checked'), function (chk) {
              return $(chk).val();
            });

            if (modelIdList && modelIdList.length == 0) {
              toastr.error("삭제 할 항목을 선택해주세요.");
              return;
            }

            var postBody = {
              modelIdList: modelIdList
            };

            if (confirm("선택한 항목을 삭제하시겠습니까?")) {
              $.ajax({
                url: this.baseUrl + "/deploy/model/api/delete",
                method: "post",
                contentType: 'application/json; charset=UTF-8',
                dataType: "json",
                data: JSON.stringify(postBody)
              }).done(result => {
                if (result.resultCode == "0000") {
                  toastr.success(result.resultMsg);
                } else {
                  toastr.error(result.resultMsg);
                }

                this.search();
              });
            }
          },

          // 등록 팝업 초기화
          initializeInsertDialog: function () {
            $("#insert-file-name").data('instance').value = '';
            $("#insert-file-input").val('');
            $($('#insert-service-model')[0].parentElement).data('instance').value = '';
            $($('#insert-data-num')[0].parentElement).data('instance').value = '';
            $($('#insert-modelType')[0].parentElement).data('instance').value = '';
            $($('#insert-result-model-id')[0].parentElement).data('instance').value = '';

            // 설명
            $($('#insert-description-input')[0].parentElement).data('instance').value = '';
            this._showValidationHelperLine('', $("#insert-description-helper-line"), '설명');
          },

          // 상세 팝업 초기화
          initializeUpdateDialog: function () {
			
            // 서비스 모델
            $($('#detail-service-model')[0].parentElement).data('instance').value = this.convertServiceModelCode2Name(this.detailObj.serviceModelId);

            // 작성자
            $($('#detail-uploaded-by')[0].parentElement).data('instance').value = this.convertString(this.detailObj.uploadedBy);

            // 학습 데이터 수
            if(this.detailObj.modelType == 'SERVICE' || this.detailObj.modelType == 'CLASS' || this.detailObj.modelType == 'E2ELM') {
				$($('#detail-data-num')[0].parentElement).data('instance').value = this.convertString(this.detailObj.dataNum);	
			}else {
				$($('#detail-data-num')[0].parentElement).data('instance').value = this.convertString(this.detailObj.dataTime);
			}
            
            // 모델타입
            $($('#detail-modelType')[0].parentElement).data('instance').value = this.convertString(this.detailObj.modelType);

            // 모델 ID
            $($('#detail-result-model-id')[0].parentElement).data('instance').value = this.convertString(this.detailObj.resultModelId);

            // 설명
            if (this.detailObj.description != null && this.detailObj.description != undefined && this.detailObj.description != '') {
              $($('#detail-description-input')[0].parentElement).data('instance').value = this.detailObj.description;
              this._showValidationHelperLine('', $("#detail-description-helper-line"), '설명');
              
            }else { // 실제 detailObj.description 값이 없음에도 이전에 다른 상세조회 항목값이 있으면 그 값이 보여지는 문제발생하여 추가
				$($('#detail-description-input')[0].parentElement).data('instance').value = "";
			}
          },

          // 검색 이벤트
          initSearchBarEvents: function () {
            var self = this;
            $('.search-bar input').on("keydown", function (e) {
              if (e.keyCode == 13) {
                self.search(true);
              }
            });
          },

          initMaterialDatepickers: function () {

            // datepicker 적용
            var self = this;
            var $trainStartAtInput = $('#train-start-date-mdc');
            var $trainEndAtInput = $('#train-end-date-mdc');


            // https://github.com/FreddyFY/material-datepicker
            var datepickerOption = {
              lang: "en",
              orientation: "portrait",
              color: document.defaultView.getComputedStyle(document.documentElement).getPropertyValue("--mdc-theme-primary"),
              closeAfterClick: false,
              outputFormat: 'YYYY-MM-DD',
              topHeaderFormat: 'YYYY MM',
              headerFormat: 'Do' // 1st 2nd ... 30th 31st
            };

            if ($trainStartAtInput.data('datepicker') != null) {
              $trainStartAtInput.data('datepicker').destroy();
            }

            $trainStartAtInput.data('datepicker', new MaterialDatepicker($trainStartAtInput.data('instance').input, $.extend({}, datepickerOption, {
              onChange: function (date) {
                if (_.isEmpty($trainStartAtInput.data('instance').value)) {
                  self.searchCondition.from = "";
                } else {
                  self.searchCondition.from = moment(date).format("YYYY-MM-DD");
                }
              }
            })));

            if ($trainEndAtInput.data('datepicker') != null) {
              $trainEndAtInput.data('datepicker').destroy();
            }

            $trainEndAtInput.data('datepicker', new MaterialDatepicker($trainEndAtInput.data('instance').input, $.extend({}, datepickerOption, {
              onChange: function (date) {
                if (_.isEmpty($trainEndAtInput.data('instance').value)) {
                  self.searchCondition.to = "";
                } else {
                  self.searchCondition.to = moment(date).format("YYYY-MM-DD");
                }
              }
            })));

            $trainStartAtInput.data('instance').value = '';
            $trainEndAtInput.data('instance').value = '';
          },

          _setSearchResults: function (result) {
            this.searchResults = result;
          },
          _setSearchResultsPageInfo: function (data) {
            this.pageInfo.pages = data.pages;
            this.pageInfo.total = data.total;
            this.currentPage = data.pageNum;
          },
          _setSearching: function (searching) {
            this.searching = searching;
          },
		  /*
             모든 체크박스 해제
          */
          unCheckAllCheckboxs: function() {
			$("input[type=checkbox]").prop('checked', false);
		  },
          // 페이지네이션
          gotoPage: function (pageNum) {
            let validPageNum = pageNum;
            if (pageNum < 1) {
              validPageNum = 1;
            } else if (pageNum > this.pageInfo.pages) {
              validPageNum = this.pageInfo.pages;
            }

            this.currentPage = validPageNum;
            this.search();
          },

          // insert 이벤트
          onChangeInsertFile: function (e) {
			const self = this;
            var $file = e.target.files[0];

            JSZip.loadAsync($file).then(function($content) {
              // if you return a promise in a "then", you will chain the two promises
              var extension = /(.json)$/;
              var tarGzExtension = /(.tar.gz)$/;

              Object.keys($content.files).filter(function (fileName) {
                return extension.test(fileName.toLowerCase());
              }).map(function (fileName) {
                var curFile = $content.files[fileName];
                curFile.async("string").then(function (data) {
                  var json = JSON.parse(data);

                  if (json.serviceModel == null || (json.dataNum == null && json.dataTime ==null) || json.resultModelId == null) {
                    return;
                  }
					console.log(">>>> deploy model meta data json : " , json);
                  // 서비스 모델
                  $($('#insert-service-model')[0].parentElement).data('instance').value = json.serviceModel;

                  // 학습 데이터 양
                  if(json.dataTime != null && json.dataTime != undefined){
					$($('#insert-data-num')[0].parentElement).data('instance').value = json.dataTime;  
				  }else {
					$($('#insert-data-num')[0].parentElement).data('instance').value = json.dataNum;  
				  }

				  // 모델타입
				  if(json.modelType != null && json.modelType != undefined){ // 이전에 다운받은 모델은 타입값이 없으므로
					$($('#insert-modelType')[0].parentElement).data('instance').value = json.modelType  
				  }
		
                  // 모델 ID
                  $($('#insert-result-model-id')[0].parentElement).data('instance').value = json.resultModelId;

                  $($('#insert-modelAuthKey-input')[0].parentElement).data('instance').value = json.modelAuthKey;
                });
              });

              Object.keys($content.files).filter(function (fileName) {
                return tarGzExtension.test(fileName.toLowerCase());
              }).map(function (fileName) {				  
                $('#modelFileName').val(fileName);
                $($('#insert-modelFileName-input')[0].parentElement).data('instance').value = fileName;
              });
            });
			
            var updateFileName = e.target.files[0].name;
            $("#insert-file-name").data('instance').value = updateFileName;
            
            this.checkDuplicateModelId(this.newObj.resultModelId);
            
          },
          
          onChangeInsertDescription: function (e) {
            var newDescription = e.target.value;
            //e.target.value = newDescription;

            var $helperLine = $("#insert-description-helper-line")

            if (this.validateDescription(e.target.value)) {
              this._showValidationHelperLine("VALID", $helperLine, "설명");
              this.newObj.description = newDescription;
            } else {
              this._showValidationHelperLine("INVALID", $helperLine, "설명");
              e.target.focus();
            }

          },
          _showValidationHelperLine: function (mode, $helperline, key) {
            if (mode == "VALID") {
              $helperline.html(
                      `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--success">
                                                        사용 가능한 ${key}입니다.
                                                    </p>`
              )
            } else if (mode == "DUPCHECK") {
              $helperline.html(
                      `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--warning ">
                                                        ${key} 중복 체크를 해주세요.
                                                    </p>`
              )
            } else if (mode == "INVALID") {
              $helperline.html(
                      `<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg mdc-theme--error ">
                                                        유효하지 않은 ${key}입니다.
                                                    </p>`
              )
            } else {
              $helperline.html('<p class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent mdc-text-field-helper-text--validation-msg "></p>');
            }
          },
          onChangeUpdateDescription: function (e) {
            var newObj = e.target.value;
            //e.target.value = newObj;

            var $helperLine = $("#detail-description-helper-line")

            if (this.validateDescription(e.target.value)) {
              this._showValidationHelperLine("", $helperLine, "설명");
            } else {
              this._showValidationHelperLine("INVALID", $helperLine, "설명");
              e.target.focus();
            }

            this.detailObj.description = newObj;
          },
          // 유효성 검사 (액션별)
          validateInsert: function () {
            var serviceModelName = $($('#insert-service-model')[0].parentElement).data('instance').value;
            this.newObj.serviceModelId = this.SERVICE_MODEL_NAME_TO_CODE[serviceModelName];
            var dataNumValue = $($('#insert-data-num')[0].parentElement).data('instance').value;
            var modelTypeValue = $($('#insert-modelType')[0].parentElement).data('instance').value;
            if( modelTypeValue == 'E2ESL' || modelTypeValue == 'E2EMSL' || modelTypeValue == 'E2EUSL' ){
				this.newObj.dataTime = dataNumValue;
				this.newObj.dataNum = 0;
				if(modelTypeValue == null || modelTypeValue == undefined || modelTypeValue.length ==0) {
					this.newObj.modelType = "E2ESL";					
				}else {
					this.newObj.modelType = modelTypeValue;					
				}
			}else if( modelTypeValue == 'E2ELM' || modelTypeValue == 'SERVICE' || modelTypeValue == 'CLASS' ) {
				this.newObj.dataTime = "0";
				this.newObj.dataNum = dataNumValue;
				if(modelTypeValue == null || modelTypeValue == undefined || modelTypeValue.length ==0) {
					this.newObj.modelType = "E2ELM";
				}else {
					this.newObj.modelType = modelTypeValue;					
				}
			}
            this.newObj.resultModelId = $($('#insert-result-model-id')[0].parentElement).data('instance').value;
            this.newObj.modelAuthKey = $($('#insert-modelAuthKey-input')[0].parentElement).data('instance').value;
            this.newObj.modelFileName = $($('#insert-modelFileName-input')[0].parentElement).data('instance').value;
            this.newObj.description = $($("#insert-description-input")[0].parentElement).data('instance').value;
			//var checkDupModelId = this.checkDuplicateModelId(this.newObj.resultModelId);
			console.log(">>> checkDupModelId : " , this.checkDupModelId);
			if(!this.checkDupModelId){
				toastr.error("동일한 모델ID값이 존재합니다.</br>다른 모델파일을 선택해주세요.")
              	return;
			}

            // 서비스 모델
            if (this.newObj.serviceModelId == null || this.newObj.serviceModelId == undefined || this.newObj.serviceModelId == 0) {
              toastr.error("서비스 모델 오류, 올바른 모델을 업로드해주세요.")
              return;
            }

            if (this.newObj.dataNum == null || this.newObj.dataNum == undefined) {
              toastr.error("학습데이터 양 오류, 올바른 모델을 업로드해주세요.")
              return;
            }

            if (this.newObj.resultModelId == null || this.newObj.resultModelId == undefined || this.newObj.resultModelId == 0) {
              toastr.error("모델ID 오류, 올바른 모델을 업로드해주세요.")
              return;
            }

            if (this.newObj.modelAuthKey == null || this.newObj.modelAuthKey == undefined || this.newObj.modelAuthKey == 0) {
              toastr.error("올바른 모델을 업로드해주세요.")
              return;
            }

            // 설명
            if (!this.validateDescription($($("#insert-description-input")[0].parentElement).data('instance').value)) {
              toastr.error("설명은 최대" + this.DESCRIPTION_MAX_LENGTH + "자 까지 입력 가능합니다.")
              return;
            }
            
            // 설명 빈값
            if ( this.newObj.description == null || this.newObj.description == undefined || this.newObj.description.length == 0) {
              toastr.error("설명을 입력해주세요.")
              return;
            }

            return true;
          },

          validateUpdate: function () {
			var descriptionValue = $($("#detail-description-input")[0].parentElement).data('instance').value;

            // 설명
            if (!this.validateDescription(descriptionValue)) {
              toastr.error("설명은 최대" + this.DESCRIPTION_MAX_LENGTH + "자 까지 입력 가능합니다.")
              return;
            }
            
            // 설명 빈값
            if ( descriptionValue == null || descriptionValue == undefined || descriptionValue.length == 0 ) {
              toastr.error("설명을 입력해주세요.")
              return;
            }

            return true;
          },
          validateDescription: function (value) {
            // 최대 글자
            //var newValue = value;
            //return newValue.length <= this.DESCRIPTION_MAX_LENGTH;
            return true;
          },
          
          // 학습된 모델ID값 중복체크
        checkDuplicateModelId: function (data) {
            
            var newObj = {
                "resultModelId": String(data)
            }
            
            $.ajax({
                url: this.baseUrl + "/deploy/model/api/existModelId",
                method: "post",
                data: newObj,
                dataType: "json"
            }).done(data => {
                
                if (data.resultCode == "0000") {
                    //obj.datasetDupCheck = true;
                    this.checkDupModelId = true;
                    console.log("true");
                    
                } else {
					this.checkDupModelId = false;
					console.log("false");
                    //toastr.error("이미 등록된 정답지 데이터셋명 입니다.");
                }
                //callback();
            })
            
        },

          // 상세 페이지 오픈
          openDetailDialog: function (deployModelId) {
            var self = this;
            this.detail(deployModelId, () => self.detailDialog.open());
          },
          selectAllRows: function () {
            var toggle = $("#toggleDelete").is(':checked');

            $('.deleteChk:checkbox').each(function () {
              $(this).prop('checked', toggle);
            });
          },
          convertString: function (s) {
            return s === null ? "" : s;
          },
          convertServiceModelCode2Name: function(serviceCode) {
            return this.SERVICE_MODEL_CODE_TO_NAME[serviceCode];
          },
          convertServiceModelId2Name: function(id) {
            return this.SERVICE_MODEL_ID_TO_NAME[id];
          },
          convertServiceModelName2Id: function(modelName) {
            return this.SERVICE_MODEL_NAME_TO_ID[modelName];
          },
          convertServiceModelName2Code: function(modelName) {
            return this.SERVICE_MODEL_NAME_TO_CODE[modelName];
          },
          // 모델 다운로드
          requestResultModelDownload: function (resultModelId) {
            if (confirm("모델 다운로드를 하시겠습니까?")) {
              var self = this;

              $.ajax({
                url: this.baseUrl + "/resultmodelid/api/check?resultModelId=" + resultModelId,
                method: "get",
                contentType: 'application/json; charset=UTF-8',
                dataType: "json"
              }).done(data => {
                if (data.result == true) {
                  this.downloadResultModel(resultModelId)
                } else {
                  toastr.error("파일이 존재하지 않습니다.");
                }
              })
            }
          },
          downloadResultModel: function(resultModelId) {
            $.ajax({
              url: this.baseUrl + '/resultmodelid/api/download?resultModelId=' + resultModelId,
              type: 'GET',
              cache: false,
              xhrFields: {
                responseType: "blob",
              },
              success: function (data, textStatus, jqXHR) {
                if (jqXHR.readyState == 4 && jqXHR.status == 200) {
                  let filename = resultModelId + ".zip";
                  let blob = new Blob([data], {type: "application/octetstream"});
                  let link = document.createElement('a');
                  link.href = window.URL.createObjectURL(blob);
                  link.download = filename;
                  link.click();
                } else {
                  toastr.error("모델 다운로드에 실패했습니다.")
                }
              },
              error: function (jqXHR, textStatus, errorThrown) {
                toastr.error("모델 다운로드에 실패했습니다.")
              },
              complete: function () {

              },
			
            });
          },
			setDialogLoading: function (loadingBarJqueryEl, option) {
				if (option == true) {
					loadingBarJqueryEl.show();
					return;
				}
				loadingBarJqueryEl.hide();
			},

          /**
           * 모달 닫을 때 데이터 요청/전송 취소
           */
          onCloseDialog: function () {
              const self = this;
              if (self.currentXhr.length !== 0) {
                  if (self.checkXhrAbort && !confirm('취소 시 저장 및 업로드가 중단됩니다.')) return;
                  [...self.currentXhr].forEach(xhrItem => xhrItem.xhr.abort())
                  self.dispatchProcessing('done');
              }
              if (self.currentDialog) {
                  self[self.currentDialog].close();
                  self.currentDialog = null;
              }
          },

          /**
           *
           * @param state: 'process' || 'done'
           * 디스패치 시 모달 본문에 유저 동작 방지 적용 및 닫기/취소를 제외한 버튼 비활성화
           */
          dispatchProcessing: function (state) {
              let $modalSurface;
              let $modalBtn;
              if (state === 'process') {
                  // 닫기/취소를 제외한 버튼 선택
                  $modalBtn = $('.mdc-dialog--open .mdc-dialog__surface .mdc-button').not('.close-button');
                  // 현재 열려있는 모달 선택
                  $modalSurface = $('.mdc-dialog--open .mdc-dialog__surface');
                  $modalBtn.prop('disabled', true);
                  $modalSurface.addClass('is-processing');
              } else if (state === 'done') {
                  // 진행 중인 모달 선택.
                  // 모달 닫는게 먼저 실행되면 .mdc-dialog--open으로 선택 불가
                  $modalBtn = $('.mdc-dialog__surface.is-processing .mdc-button').not('.close-button');
                  $modalSurface = $('.mdc-dialog__surface.is-processing');
                  $modalBtn.prop('disabled', false);
                  $modalSurface.removeClass('is-processing');
              }
          },
        }
      });
    })();
  </script>
</th:block>


</html>
